<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Push & Pull - Zeek Squad</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 600px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 20px; }
        .header h1 { font-size: 2rem; text-shadow: 3px 3px 6px rgba(0,0,0,0.3); }

        .back-btn {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            color: white;
            text-decoration: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 15px;
            transition: all 0.3s;
            cursor: pointer;
        }
        .back-btn:hover { background: rgba(255,255,255,0.3); }

        .progress-container {
            background: rgba(255,255,255,0.3);
            border-radius: 15px;
            height: 15px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #FFD700, #FFA500);
            border-radius: 15px;
            width: 0%;
            transition: width 0.5s ease;
        }

        .stars { text-align: center; font-size: 2rem; margin-bottom: 15px; }
        .star { color: rgba(255,255,255,0.3); transition: all 0.5s; display: inline-block; }
        .star.earned { color: #FFD700; filter: drop-shadow(0 0 10px #FFD700); animation: starEarn 0.6s ease; }
        @keyframes starEarn { 0% { transform: scale(0) rotate(-180deg); } 50% { transform: scale(1.5) rotate(20deg); } 100% { transform: scale(1) rotate(0); } }

        .mascot { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .mascot-emoji { font-size: 4rem; animation: push-pull 2s ease-in-out infinite; }
        @keyframes push-pull {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(15px); }
            75% { transform: translateX(-15px); }
        }
        .speech-bubble {
            background: white;
            padding: 15px 20px;
            border-radius: 20px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            flex: 1;
            font-size: 1.1rem;
        }
        .speech-bubble:before {
            content: '';
            position: absolute;
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            border: 10px solid transparent;
            border-right-color: white;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .tab-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 20px 20px 0 0;
            font-family: inherit;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255,255,255,0.3);
            color: white;
        }
        .tab-btn:hover { background: rgba(255,255,255,0.5); }
        .tab-btn.active {
            background: white;
            color: #8e44ad;
            transform: translateY(-3px);
        }
        .tab-btn.completed {
            background: #27ae60;
            color: white;
        }
        .tab-btn.completed.active {
            background: #2ecc71;
            color: white;
        }

        .game-card {
            background: white;
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .game-card h2 { color: #8e44ad; margin-bottom: 15px; font-size: 1.3rem; text-align: center; }

        .item-display {
            text-align: center;
            font-size: 5rem;
            margin: 15px 0;
            animation: itemBounce 1s ease-in-out infinite;
        }
        @keyframes itemBounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        .item-name {
            text-align: center;
            font-size: 1.4rem;
            color: #333;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .choice-btns {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .choice-btn {
            padding: 18px 35px;
            font-size: 1.3rem;
            font-weight: bold;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        .choice-btn.push {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }
        .choice-btn.pull {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }
        .choice-btn:hover { transform: scale(1.1); }
        .choice-btn:active { transform: scale(0.95); }
        .choice-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .choice-btn .arrow { font-size: 1.8rem; }

        .feedback {
            text-align: center;
            padding: 15px;
            border-radius: 15px;
            margin-top: 15px;
            display: none;
            font-weight: bold;
            font-size: 1.1rem;
            animation: feedbackPop 0.4s ease;
        }
        @keyframes feedbackPop { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .feedback.show { display: block; }
        .feedback.success { background: #d4edda; color: #155724; }
        .feedback.wrong { background: #f8d7da; color: #721c24; }

        .next-btn {
            display: none;
            width: 100%;
            padding: 16px;
            font-size: 1.2rem;
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            margin-top: 15px;
            transition: all 0.3s;
        }
        .next-btn.show { display: block; }
        .next-btn:hover { transform: scale(1.02); }

        .question-counter {
            text-align: center;
            color: white;
            font-size: 1rem;
            margin-bottom: 15px;
            background: rgba(0,0,0,0.2);
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
        }

        /* Experiment Tab */
        .experiment-area {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
        }
        .car-track {
            background: linear-gradient(to bottom, #555 0%, #333 100%);
            height: 80px;
            border-radius: 10px;
            position: relative;
            margin: 20px 0;
            overflow: hidden;
        }
        .car-track:before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background: repeating-linear-gradient(90deg, #FFD700, #FFD700 20px, transparent 20px, transparent 40px);
            transform: translateY(-50%);
        }
        .car {
            position: absolute;
            font-size: 3rem;
            top: 50%;
            transform: translateY(-50%);
            left: 20px;
            transition: left 1s ease-out;
        }

        .force-btns {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        .force-btn {
            padding: 15px 25px;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s;
        }
        .force-btn.soft { background: #74b9ff; color: white; }
        .force-btn.hard { background: #0984e3; color: white; }
        .force-btn:hover { transform: scale(1.05); }

        /* Sorting Tab */
        .sorting-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .sorting-zone {
            flex: 1;
            min-width: 140px;
            background: #f0f0f0;
            border-radius: 20px;
            padding: 15px;
            min-height: 200px;
            border: 3px dashed #ccc;
            transition: all 0.3s;
        }
        .sorting-zone.push-zone { border-color: #3498db; background: #ebf5fb; }
        .sorting-zone.pull-zone { border-color: #e74c3c; background: #fdedec; }
        .sorting-zone h3 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        .sorting-zone.push-zone h3 { color: #3498db; }
        .sorting-zone.pull-zone h3 { color: #e74c3c; }
        .sorting-zone.highlight { transform: scale(1.02); box-shadow: 0 5px 20px rgba(0,0,0,0.2); }

        .sorting-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        .sorting-item {
            background: white;
            padding: 15px 20px;
            border-radius: 15px;
            font-size: 2rem;
            cursor: grab;
            box-shadow: 0 3px 10px rgba(0,0,0,0.15);
            transition: all 0.3s;
            user-select: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        .sorting-item:hover { transform: scale(1.1); }
        .sorting-item:active { cursor: grabbing; }
        .sorting-item .label { font-size: 0.8rem; color: #666; }
        .sorting-item.sorted {
            cursor: default;
            opacity: 0.9;
        }
        .sorting-item.selected { border: 3px solid #9b59b6; background: #f3e5f5; }
        .sorting-item.correct { background: #d4edda; }
        .sorting-item.wrong { background: #f8d7da; animation: shake 0.5s; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Matching Tab */
        .match-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .match-column {
            flex: 1;
            min-width: 150px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .match-item {
            background: white;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }
        .match-item:hover { transform: scale(1.05); }
        .match-item.selected { border-color: #9b59b6; background: #f3e5f5; }
        .match-item.matched { background: #d4edda; border-color: #27ae60; cursor: default; }
        .match-item .emoji { font-size: 2.5rem; display: block; margin-bottom: 5px; }
        .match-item .text { font-size: 0.9rem; color: #333; }

        .hidden { display: none !important; }

        .celebration {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .celebration.show { display: flex; }
        .celebration-content {
            background: white;
            border-radius: 30px;
            padding: 40px;
            text-align: center;
            animation: celebrationPop 0.5s ease;
            max-width: 90%;
        }
        @keyframes celebrationPop { 0% { transform: scale(0); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .celebration h2 { color: #8e44ad; font-size: 2rem; margin-bottom: 15px; }
        .celebration .trophy { font-size: 5rem; margin-bottom: 15px; }
        .celebration .stars-final { font-size: 3rem; color: #FFD700; margin-bottom: 20px; }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            top: -10px;
            animation: confettiFall 3s linear forwards;
            z-index: 1001;
        }
        @keyframes confettiFall { to { transform: translateY(100vh) rotate(720deg); opacity: 0; } }

        .submit-btn {
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s;
        }
        .submit-btn:hover { transform: scale(1.05); }

        .complete-section-btn {
            display: none;
            width: 100%;
            padding: 16px;
            font-size: 1.2rem;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            margin-top: 20px;
            transition: all 0.3s;
        }
        .complete-section-btn.show { display: block; }
        .complete-section-btn:hover { transform: scale(1.02); }

        .info-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        .info-box .info-emoji { font-size: 2rem; margin-bottom: 5px; }
        .info-box p { color: #856404; font-size: 1rem; }

        @media (max-width: 480px) {
            .header h1 { font-size: 1.6rem; }
            .mascot-emoji { font-size: 3rem; }
            .choice-btn { padding: 15px 25px; font-size: 1.1rem; }
            .item-display { font-size: 4rem; }
            .sorting-zone { min-width: 100%; }
            .match-column { min-width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-btn">‚Üê Back to Games</a>

        <div class="header">
            <h1>üî¨ Push & Pull Forces!</h1>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="stars">
            <span class="star" id="star1">‚òÖ</span>
            <span class="star" id="star2">‚òÖ</span>
            <span class="star" id="star3">‚òÖ</span>
        </div>

        <div class="mascot">
            <div class="mascot-emoji">ü§ñ</div>
            <div class="speech-bubble" id="speechBubble">
                Hi! I'm Robo! Let's learn about PUSH and PULL forces! They make things MOVE!
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-btn active" data-tab="identify" onclick="switchTab('identify')">ü§î Identify</button>
            <button class="tab-btn" data-tab="sort" onclick="switchTab('sort')">üì¶ Sort</button>
            <button class="tab-btn" data-tab="match" onclick="switchTab('match')">üîó Match</button>
            <button class="tab-btn" data-tab="experiment" onclick="switchTab('experiment')">üöó Experiment</button>
        </div>

        <!-- Tab 1: Identify Push or Pull -->
        <div class="tab-content" id="tab-identify">
            <div style="text-align: center;">
                <span class="question-counter" id="questionCounter">Question 1 of 10</span>
            </div>

            <div class="game-card">
                <h2>ü§î Is it PUSH or PULL?</h2>
                <div class="item-display" id="itemDisplay">üö™</div>
                <div class="item-name" id="itemName">Opening a door toward you</div>

                <div class="choice-btns">
                    <button class="choice-btn push" id="pushBtn" onclick="checkIdentify('push')">
                        <span class="arrow">üëâ</span>
                        <span>PUSH</span>
                    </button>
                    <button class="choice-btn pull" id="pullBtn" onclick="checkIdentify('pull')">
                        <span class="arrow">üëà</span>
                        <span>PULL</span>
                    </button>
                </div>

                <div class="feedback" id="identifyFeedback"></div>
                <button class="next-btn" id="identifyNextBtn" onclick="nextIdentify()">Next Question ‚Üí</button>
            </div>
        </div>

        <!-- Tab 2: Sort Items -->
        <div class="tab-content hidden" id="tab-sort">
            <div class="game-card">
                <h2>üì¶ Sort into PUSH or PULL!</h2>
                <p style="text-align: center; color: #666; margin-bottom: 15px;">Tap an item, then tap where it belongs!</p>

                <div class="sorting-items" id="sortingItems"></div>

                <div class="sorting-container">
                    <div class="sorting-zone push-zone" id="pushZone" onclick="dropInZone('push')">
                        <h3>üëâ PUSH</h3>
                        <div class="zone-items" id="pushZoneItems"></div>
                    </div>
                    <div class="sorting-zone pull-zone" id="pullZone" onclick="dropInZone('pull')">
                        <h3>üëà PULL</h3>
                        <div class="zone-items" id="pullZoneItems"></div>
                    </div>
                </div>

                <div class="feedback" id="sortFeedback"></div>
                <button class="complete-section-btn" id="sortCompleteBtn" onclick="completeSort()">Continue to Matching! ‚Üí</button>
            </div>
        </div>

        <!-- Tab 3: Match Actions -->
        <div class="tab-content hidden" id="tab-match">
            <div class="game-card">
                <h2>üîó Match the Force to the Action!</h2>
                <p style="text-align: center; color: #666; margin-bottom: 15px;">Tap a force, then tap its matching action!</p>

                <div class="match-container">
                    <div class="match-column" id="forceColumn"></div>
                    <div class="match-column" id="actionColumn"></div>
                </div>

                <div class="feedback" id="matchFeedback"></div>
                <button class="complete-section-btn" id="matchCompleteBtn" onclick="completeMatch()">Continue to Experiment! ‚Üí</button>
            </div>
        </div>

        <!-- Tab 4: Experiment -->
        <div class="tab-content hidden" id="tab-experiment">
            <div class="game-card">
                <h2>üöó Force Experiment!</h2>

                <div class="info-box">
                    <div class="info-emoji">üí°</div>
                    <p>More force = more movement!</p>
                </div>

                <div class="experiment-area">
                    <p style="color: #666; margin-bottom: 10px;">Push the car SOFT or HARD - see what happens!</p>
                    <div class="car-track">
                        <div class="car" id="car">üöó</div>
                    </div>

                    <div class="force-btns">
                        <button class="force-btn soft" onclick="pushCar('soft')">ü§è Soft Push</button>
                        <button class="force-btn hard" onclick="pushCar('hard')">üí™ Hard Push</button>
                    </div>

                    <button class="force-btn" onclick="resetCar()" style="margin-top: 10px; background: #636e72; color: white;">üîÑ Reset</button>
                </div>

                <div class="feedback" id="experimentFeedback"></div>

                <div id="experimentTasks" style="margin-top: 20px;">
                    <h3 style="text-align: center; margin-bottom: 15px;">üî¨ Complete These Tasks:</h3>
                    <div id="taskList"></div>
                </div>

                <button class="complete-section-btn" id="experimentCompleteBtn" onclick="finishGame()">I'm a Force Scientist! üî¨</button>
            </div>
        </div>
    </div>

    <div class="celebration" id="celebration">
        <div class="celebration-content">
            <div class="trophy">üèÜ</div>
            <h2>FORCE SCIENTIST!</h2>
            <div class="stars-final" id="starsFinal">‚òÖ‚òÖ‚òÖ</div>
            <p style="font-size: 1.2rem; margin-bottom: 10px;">You understand PUSH and PULL!</p>
            <p style="color: #666; margin-bottom: 20px;">Remember: Forces make things MOVE!</p>
            <a href="index.html" class="submit-btn">Play More Games!</a>
        </div>
    </div>

    <script>
        var audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            var osc = audioCtx.createOscillator();
            var gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if (type === 'correct') {
                osc.frequency.setValueAtTime(523, audioCtx.currentTime);
                osc.frequency.setValueAtTime(659, audioCtx.currentTime + 0.1);
                osc.frequency.setValueAtTime(784, audioCtx.currentTime + 0.2);
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                osc.start(); osc.stop(audioCtx.currentTime + 0.4);
            } else if (type === 'wrong') {
                osc.frequency.setValueAtTime(200, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.2);
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                osc.start(); osc.stop(audioCtx.currentTime + 0.2);
            } else if (type === 'star') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(800, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start(); osc.stop(audioCtx.currentTime + 0.5);
            } else if (type === 'push') {
                osc.frequency.setValueAtTime(300, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(500, audioCtx.currentTime + 0.15);
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                osc.start(); osc.stop(audioCtx.currentTime + 0.2);
            } else if (type === 'click') {
                osc.frequency.setValueAtTime(600, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start(); osc.stop(audioCtx.currentTime + 0.1);
            }
        }

        // Helper function to clear all children from an element
        function clearChildren(element) {
            while (element.firstChild) {
                element.removeChild(element.firstChild);
            }
        }

        // Global state
        var starsEarned = 0;
        var totalCorrect = 0;
        var tabsCompleted = { identify: false, sort: false, match: false, experiment: false };

        // ============== IDENTIFY TAB ==============
        var identifyQuestions = [
            { emoji: 'üö™', name: 'Opening a door toward you', answer: 'pull', hint: 'You bring the door toward you!' },
            { emoji: 'üì¶', name: 'Sliding a box away', answer: 'push', hint: 'You move the box away from you!' },
            { emoji: 'üõí', name: 'Moving a shopping cart', answer: 'push', hint: 'You move the cart forward!' },
            { emoji: 'üß≤', name: 'Magnet attracting metal', answer: 'pull', hint: 'The magnet brings metal closer!' },
            { emoji: '‚öΩ', name: 'Kicking a ball', answer: 'push', hint: 'Your foot moves the ball away!' },
            { emoji: 'üé£', name: 'Reeling in a fish', answer: 'pull', hint: 'You bring the fish toward you!' },
            { emoji: 'ü™ë', name: 'Pulling out a chair', answer: 'pull', hint: 'You bring the chair toward you!' },
            { emoji: 'üßπ', name: 'Sweeping with a broom', answer: 'push', hint: 'You move dirt away from you!' },
            { emoji: 'üöó', name: 'Starting a stalled car', answer: 'push', hint: 'You push the car to move it!' },
            { emoji: 'ü™£', name: 'Pulling water from a well', answer: 'pull', hint: 'You bring the bucket up toward you!' }
        ];
        var identifyIndex = 0;
        var identifyCorrect = 0;

        function loadIdentify() {
            var q = identifyQuestions[identifyIndex];
            document.getElementById('questionCounter').textContent = 'Question ' + (identifyIndex + 1) + ' of ' + identifyQuestions.length;
            document.getElementById('itemDisplay').textContent = q.emoji;
            document.getElementById('itemName').textContent = q.name;
            document.getElementById('identifyFeedback').className = 'feedback';
            document.getElementById('identifyNextBtn').className = 'next-btn';
            document.getElementById('pushBtn').disabled = false;
            document.getElementById('pullBtn').disabled = false;
            updateSpeech(q.hint);
        }

        function checkIdentify(answer) {
            var q = identifyQuestions[identifyIndex];
            document.getElementById('pushBtn').disabled = true;
            document.getElementById('pullBtn').disabled = true;

            var feedback = document.getElementById('identifyFeedback');
            if (answer === q.answer) {
                playSound('correct');
                feedback.textContent = 'üéâ Correct! ' + q.name + ' is a ' + q.answer.toUpperCase() + '!';
                feedback.className = 'feedback show success';
                identifyCorrect++;
                totalCorrect++;
                updateSpeech('Great job! You got it right!');
            } else {
                playSound('wrong');
                feedback.textContent = '‚ùå Not quite! ' + q.name + ' is a ' + q.answer.toUpperCase() + '.';
                feedback.className = 'feedback show wrong';
                updateSpeech('Remember: Push moves away, Pull brings closer!');
            }

            document.getElementById('identifyNextBtn').className = 'next-btn show';
            updateProgress();
        }

        function nextIdentify() {
            identifyIndex++;
            if (identifyIndex >= identifyQuestions.length) {
                tabsCompleted.identify = true;
                markTabComplete('identify');
                earnStar(1);
                switchTab('sort');
            } else {
                loadIdentify();
            }
        }

        // ============== SORT TAB ==============
        var sortItems = [
            { emoji: 'üõ∑', name: 'Sled', answer: 'pull' },
            { emoji: 'üéà', name: 'Balloon', answer: 'push' },
            { emoji: 'üß≥', name: 'Suitcase', answer: 'pull' },
            { emoji: 'üßä', name: 'Ice block', answer: 'push' },
            { emoji: 'ü™Å', name: 'Kite', answer: 'pull' },
            { emoji: 'üö≤', name: 'Bike pedals', answer: 'push' },
            { emoji: 'üßµ', name: 'Thread', answer: 'pull' },
            { emoji: 'üéØ', name: 'Dart', answer: 'push' }
        ];
        var selectedSortItem = null;
        var sortedCount = 0;

        function initSort() {
            var container = document.getElementById('sortingItems');
            clearChildren(container);

            // Shuffle items
            var shuffled = sortItems.slice().sort(function() { return Math.random() - 0.5; });

            shuffled.forEach(function(item, idx) {
                var div = document.createElement('div');
                div.className = 'sorting-item';
                div.setAttribute('data-answer', item.answer);
                div.setAttribute('data-index', idx);

                var emojiSpan = document.createElement('span');
                emojiSpan.textContent = item.emoji;
                div.appendChild(emojiSpan);

                var labelSpan = document.createElement('span');
                labelSpan.className = 'label';
                labelSpan.textContent = item.name;
                div.appendChild(labelSpan);

                div.onclick = function() { selectSortItem(this); };
                container.appendChild(div);
            });

            clearChildren(document.getElementById('pushZoneItems'));
            clearChildren(document.getElementById('pullZoneItems'));
            sortedCount = 0;
            updateSpeech('Tap an item, then tap the PUSH or PULL zone!');
        }

        function selectSortItem(el) {
            if (el.classList.contains('sorted')) return;

            playSound('click');

            // Remove previous selection
            var items = document.querySelectorAll('.sorting-item');
            items.forEach(function(item) { item.classList.remove('selected'); });

            el.classList.add('selected');
            selectedSortItem = el;

            document.getElementById('pushZone').classList.add('highlight');
            document.getElementById('pullZone').classList.add('highlight');
        }

        function dropInZone(zone) {
            if (!selectedSortItem) return;

            var answer = selectedSortItem.getAttribute('data-answer');
            var zoneContainer = document.getElementById(zone + 'ZoneItems');

            if (zone === answer) {
                playSound('correct');
                selectedSortItem.classList.add('sorted', 'correct');

                var clone = selectedSortItem.cloneNode(true);
                clone.onclick = null;
                clone.style.fontSize = '1.5rem';
                clone.style.padding = '10px';
                zoneContainer.appendChild(clone);

                selectedSortItem.style.display = 'none';
                sortedCount++;
                totalCorrect++;

                var feedback = document.getElementById('sortFeedback');
                feedback.textContent = '‚úÖ Correct! That\'s a ' + zone.toUpperCase() + '!';
                feedback.className = 'feedback show success';

                updateSpeech('Great sorting! Keep going!');
            } else {
                playSound('wrong');
                selectedSortItem.classList.add('wrong');
                setTimeout(function() { selectedSortItem.classList.remove('wrong'); }, 500);

                var feedback = document.getElementById('sortFeedback');
                feedback.textContent = '‚ùå Try again! Think about how you use it.';
                feedback.className = 'feedback show wrong';

                updateSpeech('Oops! Think: do you move it away or bring it closer?');
            }

            selectedSortItem.classList.remove('selected');
            selectedSortItem = null;
            document.getElementById('pushZone').classList.remove('highlight');
            document.getElementById('pullZone').classList.remove('highlight');

            if (sortedCount >= sortItems.length) {
                document.getElementById('sortCompleteBtn').classList.add('show');
                updateSpeech('Amazing! You sorted all the items!');
            }

            updateProgress();
        }

        function completeSort() {
            tabsCompleted.sort = true;
            markTabComplete('sort');
            earnStar(2);
            switchTab('match');
        }

        // ============== MATCH TAB ==============
        var matchPairs = [
            { force: { emoji: 'üëâ', text: 'PUSH' }, action: { emoji: 'üöÄ', text: 'Launching a rocket' } },
            { force: { emoji: 'üëà', text: 'PULL' }, action: { emoji: 'üèπ', text: 'Drawing a bow' } },
            { force: { emoji: 'üëâ', text: 'PUSH' }, action: { emoji: 'üé±', text: 'Hitting a ball' } },
            { force: { emoji: 'üëà', text: 'PULL' }, action: { emoji: 'üß≤', text: 'Magnet on fridge' } },
            { force: { emoji: 'üëâ', text: 'PUSH' }, action: { emoji: 'üö™', text: 'Closing a door' } },
            { force: { emoji: 'üëà', text: 'PULL' }, action: { emoji: 'ü™ù', text: 'Using a hook' } }
        ];
        var matchSelected = null;
        var matchedPairs = 0;

        function initMatch() {
            var forceCol = document.getElementById('forceColumn');
            var actionCol = document.getElementById('actionColumn');
            clearChildren(forceCol);
            clearChildren(actionCol);

            // Shuffle actions
            var shuffledActions = matchPairs.slice().sort(function() { return Math.random() - 0.5; });

            matchPairs.forEach(function(pair, idx) {
                var forceDiv = document.createElement('div');
                forceDiv.className = 'match-item';
                forceDiv.setAttribute('data-type', 'force');
                forceDiv.setAttribute('data-pair', idx);

                var forceEmoji = document.createElement('span');
                forceEmoji.className = 'emoji';
                forceEmoji.textContent = pair.force.emoji;
                forceDiv.appendChild(forceEmoji);

                var forceText = document.createElement('span');
                forceText.className = 'text';
                forceText.textContent = pair.force.text;
                forceDiv.appendChild(forceText);

                forceDiv.onclick = function() { selectMatch(this); };
                forceCol.appendChild(forceDiv);
            });

            shuffledActions.forEach(function(pair, idx) {
                var originalIdx = matchPairs.indexOf(pair);

                var actionDiv = document.createElement('div');
                actionDiv.className = 'match-item';
                actionDiv.setAttribute('data-type', 'action');
                actionDiv.setAttribute('data-pair', originalIdx);

                var actionEmoji = document.createElement('span');
                actionEmoji.className = 'emoji';
                actionEmoji.textContent = pair.action.emoji;
                actionDiv.appendChild(actionEmoji);

                var actionText = document.createElement('span');
                actionText.className = 'text';
                actionText.textContent = pair.action.text;
                actionDiv.appendChild(actionText);

                actionDiv.onclick = function() { selectMatch(this); };
                actionCol.appendChild(actionDiv);
            });

            matchedPairs = 0;
            matchSelected = null;
            updateSpeech('Match each force to its action!');
        }

        function selectMatch(el) {
            if (el.classList.contains('matched')) return;

            playSound('click');

            if (!matchSelected) {
                el.classList.add('selected');
                matchSelected = el;
            } else {
                var type1 = matchSelected.getAttribute('data-type');
                var type2 = el.getAttribute('data-type');

                if (type1 === type2) {
                    // Same column - switch selection
                    matchSelected.classList.remove('selected');
                    el.classList.add('selected');
                    matchSelected = el;
                    return;
                }

                var pair1 = parseInt(matchSelected.getAttribute('data-pair'));
                var pair2 = parseInt(el.getAttribute('data-pair'));

                if (pair1 === pair2) {
                    // Correct match!
                    playSound('correct');
                    matchSelected.classList.remove('selected');
                    matchSelected.classList.add('matched');
                    el.classList.add('matched');
                    matchedPairs++;
                    totalCorrect++;

                    var feedback = document.getElementById('matchFeedback');
                    feedback.textContent = '‚úÖ Perfect match!';
                    feedback.className = 'feedback show success';

                    updateSpeech('Great matching!');

                    if (matchedPairs >= matchPairs.length) {
                        document.getElementById('matchCompleteBtn').classList.add('show');
                        updateSpeech('You matched them all! Time to experiment!');
                    }
                } else {
                    // Wrong match
                    playSound('wrong');
                    matchSelected.classList.remove('selected');

                    var feedback = document.getElementById('matchFeedback');
                    feedback.textContent = '‚ùå Try a different pair!';
                    feedback.className = 'feedback show wrong';

                    updateSpeech('Not quite - try again!');
                }

                matchSelected = null;
            }

            updateProgress();
        }

        function completeMatch() {
            tabsCompleted.match = true;
            markTabComplete('match');
            switchTab('experiment');
        }

        // ============== EXPERIMENT TAB ==============
        var experimentTasks = [
            { text: 'Push the car with a SOFT push', done: false, type: 'soft' },
            { text: 'Push the car with a HARD push', done: false, type: 'hard' },
            { text: 'Try SOFT again - watch how far it goes!', done: false, type: 'soft' },
            { text: 'Try HARD again - compare the distance!', done: false, type: 'hard' }
        ];
        var taskIndex = 0;

        function initExperiment() {
            var taskList = document.getElementById('taskList');
            clearChildren(taskList);

            experimentTasks.forEach(function(task, idx) {
                var div = document.createElement('div');
                div.style.cssText = 'padding: 10px; margin: 5px 0; border-radius: 10px; background: #f0f0f0; display: flex; align-items: center; gap: 10px;';
                div.id = 'task-' + idx;

                var checkbox = document.createElement('span');
                checkbox.style.cssText = 'font-size: 1.5rem;';
                checkbox.textContent = '‚¨ú';
                checkbox.id = 'checkbox-' + idx;
                div.appendChild(checkbox);

                var text = document.createElement('span');
                text.textContent = task.text;
                div.appendChild(text);

                taskList.appendChild(div);
            });

            taskIndex = 0;
            highlightCurrentTask();
            updateSpeech('Complete all the tasks to become a Force Scientist!');
        }

        function highlightCurrentTask() {
            experimentTasks.forEach(function(_, idx) {
                var taskEl = document.getElementById('task-' + idx);
                if (idx === taskIndex) {
                    taskEl.style.background = '#fff3cd';
                    taskEl.style.border = '2px solid #ffc107';
                } else if (experimentTasks[idx].done) {
                    taskEl.style.background = '#d4edda';
                    taskEl.style.border = '2px solid #28a745';
                } else {
                    taskEl.style.background = '#f0f0f0';
                    taskEl.style.border = 'none';
                }
            });
        }

        function pushCar(force) {
            playSound('push');
            var car = document.getElementById('car');
            var feedback = document.getElementById('experimentFeedback');

            if (force === 'soft') {
                car.style.left = '120px';
                feedback.textContent = 'ü§è Soft push = small movement!';
                updateSpeech('A soft push makes it move a LITTLE!');
            } else {
                car.style.left = '85%';
                feedback.textContent = 'üí™ Hard push = BIG movement!';
                updateSpeech('A hard push makes it go FAR! More force = more movement!');
            }
            feedback.className = 'feedback show success';

            // Check task completion
            if (taskIndex < experimentTasks.length) {
                var currentTask = experimentTasks[taskIndex];
                if (currentTask.type === force && !currentTask.done) {
                    currentTask.done = true;
                    document.getElementById('checkbox-' + taskIndex).textContent = '‚úÖ';
                    totalCorrect++;
                    taskIndex++;
                    highlightCurrentTask();

                    if (taskIndex >= experimentTasks.length) {
                        document.getElementById('experimentCompleteBtn').classList.add('show');
                        updateSpeech('You completed all tasks! You\'re a Force Scientist!');
                    }
                }
            }

            updateProgress();
        }

        function resetCar() {
            document.getElementById('car').style.left = '20px';
            playSound('click');
        }

        // ============== SHARED FUNCTIONS ==============
        function updateSpeech(text) {
            document.getElementById('speechBubble').textContent = text;
        }

        function updateProgress() {
            var total = identifyQuestions.length + sortItems.length + matchPairs.length + experimentTasks.length;
            var progress = (totalCorrect / total) * 100;
            document.getElementById('progressBar').style.width = Math.min(progress, 100) + '%';
        }

        function earnStar(num) {
            if (starsEarned >= num) return;
            var star = document.getElementById('star' + num);
            star.classList.add('earned');
            starsEarned = num;
            playSound('star');
        }

        function markTabComplete(tabName) {
            var btn = document.querySelector('.tab-btn[data-tab="' + tabName + '"]');
            btn.classList.add('completed');
        }

        function switchTab(tabName) {
            playSound('click');

            // Update buttons
            document.querySelectorAll('.tab-btn').forEach(function(btn) {
                btn.classList.remove('active');
                if (btn.getAttribute('data-tab') === tabName) {
                    btn.classList.add('active');
                }
            });

            // Show/hide content
            document.querySelectorAll('.tab-content').forEach(function(content) {
                content.classList.add('hidden');
            });
            document.getElementById('tab-' + tabName).classList.remove('hidden');

            // Initialize tab content
            if (tabName === 'sort' && sortedCount === 0) {
                initSort();
            } else if (tabName === 'match' && matchedPairs === 0) {
                initMatch();
            } else if (tabName === 'experiment' && taskIndex === 0) {
                initExperiment();
            } else if (tabName === 'identify') {
                updateSpeech(identifyQuestions[identifyIndex].hint);
            }
        }

        function finishGame() {
            tabsCompleted.experiment = true;
            markTabComplete('experiment');
            earnStar(3);
            showCelebration();
        }

        function showCelebration() {
            document.getElementById('celebration').classList.add('show');

            var starText = '';
            for (var i = 0; i < 3; i++) {
                starText += i < starsEarned ? '‚òÖ' : '‚òÜ';
            }
            document.getElementById('starsFinal').textContent = starText;
            launchConfetti();
        }

        function launchConfetti() {
            var colors = ['#8e44ad', '#FFD700', '#3498db', '#e74c3c', '#27ae60'];
            for (var i = 0; i < 50; i++) {
                (function(idx) {
                    setTimeout(function() {
                        var confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + 'vw';
                        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                        document.body.appendChild(confetti);
                        setTimeout(function() { confetti.remove(); }, 3000);
                    }, idx * 50);
                })(i);
            }
        }

        // Start game
        loadIdentify();
    </script>
</body>
</html>
