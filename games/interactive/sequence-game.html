<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sequence Challenge - Zeek Squad</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 500px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 20px; }
        .header h1 { font-size: 1.8rem; text-shadow: 3px 3px 6px rgba(0,0,0,0.3); }

        .back-btn {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            color: white;
            text-decoration: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        .back-btn:hover { background: rgba(255,255,255,0.3); }

        .progress-container {
            background: rgba(255,255,255,0.3);
            border-radius: 15px;
            height: 15px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #FFD700, #FFA500);
            border-radius: 15px;
            width: 0%;
            transition: width 0.5s ease;
        }

        .stars { text-align: center; font-size: 2rem; margin-bottom: 15px; }
        .star { color: rgba(255,255,255,0.3); transition: all 0.5s; display: inline-block; }
        .star.earned { color: #FFD700; filter: drop-shadow(0 0 10px #FFD700); animation: starEarn 0.6s ease; }
        @keyframes starEarn { 0% { transform: scale(0) rotate(-180deg); } 50% { transform: scale(1.5) rotate(20deg); } 100% { transform: scale(1) rotate(0); } }

        .mascot { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .mascot-emoji { font-size: 4rem; animation: owlBounce 1.5s ease-in-out infinite; }
        @keyframes owlBounce { 0%, 100% { transform: translateY(0) rotate(-5deg); } 50% { transform: translateY(-10px) rotate(5deg); } }
        .speech-bubble {
            background: white;
            padding: 15px 20px;
            border-radius: 20px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            flex: 1;
        }
        .speech-bubble:before {
            content: '';
            position: absolute;
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            border: 10px solid transparent;
            border-right-color: white;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab-btn {
            flex: 1;
            min-width: 80px;
            padding: 12px 8px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
            font-weight: bold;
        }
        .tab-btn:hover { background: rgba(255,255,255,0.3); }
        .tab-btn.active {
            background: white;
            color: #667eea;
            transform: scale(1.05);
        }

        .game-card {
            background: white;
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .game-card h2 { color: #667eea; margin-bottom: 15px; font-size: 1.3rem; text-align: center; }

        .level-indicator {
            text-align: center;
            margin-bottom: 15px;
        }
        .level-indicator span {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1rem;
        }

        .sequence-display {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        .sequence-item {
            width: 55px;
            height: 55px;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.3rem;
            font-weight: bold;
            color: white;
            animation: pop 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        @keyframes pop { 0% { transform: scale(0); } 80% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .color-0 { background: linear-gradient(135deg, #FF6B6B, #ee5a5a); }
        .color-1 { background: linear-gradient(135deg, #4ECDC4, #44b3aa); }
        .color-2 { background: linear-gradient(135deg, #45B7D1, #3aa3bc); }
        .color-3 { background: linear-gradient(135deg, #96CEB4, #7fc4a0); }
        .color-4 { background: linear-gradient(135deg, #DDA0DD, #c990c9); }
        .question-mark {
            background: linear-gradient(135deg, #ddd, #ccc);
            color: #666;
            font-size: 2rem;
        }

        .options-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }
        .option-btn {
            padding: 18px;
            border: 4px solid #e0e0e0;
            border-radius: 15px;
            background: white;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        .option-btn:hover { border-color: #667eea; transform: translateY(-3px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3); }
        .option-btn:active { transform: scale(0.95); }
        .option-btn.correct { background: linear-gradient(135deg, #4ECDC4, #44b3aa); border-color: #4ECDC4; color: white; }
        .option-btn.incorrect { background: linear-gradient(135deg, #FF6B6B, #ee5a5a); border-color: #FF6B6B; color: white; }

        .feedback {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            min-height: 30px;
            padding: 10px;
            border-radius: 10px;
        }
        .feedback.success { background: #d4edda; color: #155724; }
        .feedback.error { background: #f8d7da; color: #721c24; }

        .score-container {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 15px;
            margin-bottom: 15px;
        }
        .score-item { text-align: center; }
        .score-item label { display: block; font-size: 0.8rem; color: #666; margin-bottom: 5px; }
        .score-item span { font-size: 1.5rem; font-weight: bold; color: #667eea; }

        .next-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s ease;
            display: none;
            font-family: inherit;
        }
        .next-btn:hover { transform: scale(1.02); }
        .next-btn.show { display: block; }

        .shape-grid {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        .shape-item {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            animation: pop 0.3s ease;
        }
        .shape-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        .shape-option {
            padding: 15px;
            font-size: 2rem;
            border: 4px solid #e0e0e0;
            border-radius: 15px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        .shape-option:hover { border-color: #667eea; transform: scale(1.1); }
        .shape-option.correct { border-color: #4ECDC4; background: #d4edda; }
        .shape-option.wrong { border-color: #FF6B6B; background: #f8d7da; animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        .story-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        .story-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 4px solid #dee2e6;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .story-card:hover { transform: translateY(-5px); border-color: #667eea; }
        .story-card.selected { border-color: #667eea; background: #e3f2fd; }
        .story-card.placed { border-color: #4ECDC4; background: #d4edda; cursor: default; }
        .story-card.wrong { border-color: #FF6B6B; animation: shake 0.5s; }
        .story-card .emoji { font-size: 2.5rem; display: block; margin-bottom: 8px; }
        .story-card .label { font-size: 0.9rem; color: #333; }

        .sequence-slots {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }
        .sequence-slot {
            width: 70px;
            height: 70px;
            border: 4px dashed #667eea;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        .sequence-slot.filled {
            border-style: solid;
            background: #d4edda;
            font-size: 2rem;
        }

        .grow-display {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 15px;
            margin-bottom: 20px;
            min-height: 120px;
        }
        .grow-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .grow-blocks {
            display: flex;
            flex-direction: column-reverse;
        }
        .grow-block {
            width: 40px;
            height: 30px;
            background: linear-gradient(135deg, #FF6B6B, #ee5a5a);
            border-radius: 5px;
            margin-bottom: 2px;
            animation: blockPop 0.3s ease;
        }
        @keyframes blockPop { 0% { transform: scale(0); } 100% { transform: scale(1); } }
        .grow-label { font-weight: bold; color: #666; margin-top: 5px; }
        .grow-question { font-size: 3rem; color: #667eea; }

        .hidden { display: none !important; }

        .celebration {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .celebration.show { display: flex; }
        .celebration-content {
            background: white;
            border-radius: 30px;
            padding: 40px;
            text-align: center;
            animation: celebrationPop 0.5s ease;
            max-width: 90%;
        }
        @keyframes celebrationPop { 0% { transform: scale(0); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .celebration h2 { color: #667eea; font-size: 2rem; margin-bottom: 15px; }
        .celebration .trophy { font-size: 5rem; margin-bottom: 15px; }
        .celebration .stars-final { font-size: 3rem; color: #FFD700; margin-bottom: 20px; }
        .celebration p { color: #666; margin-bottom: 20px; }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            top: -10px;
            animation: confettiFall 3s linear forwards;
            z-index: 1001;
        }
        @keyframes confettiFall { to { transform: translateY(100vh) rotate(720deg); opacity: 0; } }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        .submit-btn:hover { transform: scale(1.05); }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-btn">‚Üê Back to Games</a>

        <div class="header">
            <h1>üß© Pattern Detective!</h1>
        </div>

        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div class="stars">
            <span class="star" id="star1">‚òÖ</span>
            <span class="star" id="star2">‚òÖ</span>
            <span class="star" id="star3">‚òÖ</span>
        </div>

        <div class="mascot">
            <div class="mascot-emoji">ü¶â</div>
            <div class="speech-bubble" id="speechBubble">
                Hi! I'm Oliver Owl! I LOVE patterns! Let's find what comes next!
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('number')">üî¢ Numbers</button>
            <button class="tab-btn" onclick="showTab('shape')">üî∑ Shapes</button>
            <button class="tab-btn" onclick="showTab('story')">üìñ Stories</button>
            <button class="tab-btn" onclick="showTab('grow')">üìà Growing</button>
        </div>

        <!-- Tab 1: Number Patterns -->
        <div class="game-card" id="numberTab">
            <h2>üî¢ Number Patterns</h2>
            <p style="text-align: center; color: #666; margin-bottom: 15px;">Find the missing number in the pattern!</p>

            <div class="level-indicator">
                <span id="levelDisplay">Level 1 of 8</span>
            </div>

            <div class="sequence-display" id="sequenceDisplay"></div>

            <div class="feedback" id="feedback"></div>

            <div class="options-container" id="optionsContainer"></div>

            <div class="score-container">
                <div class="score-item">
                    <label>Score</label>
                    <span id="score">0</span>
                </div>
                <div class="score-item">
                    <label>Streak</label>
                    <span id="streak">0</span>
                </div>
                <div class="score-item">
                    <label>Best</label>
                    <span id="bestStreak">0</span>
                </div>
            </div>

            <button class="next-btn" id="nextBtn" onclick="nextLevel()">Next Pattern ‚Üí</button>
        </div>

        <!-- Tab 2: Shape Patterns -->
        <div class="game-card hidden" id="shapeTab">
            <h2>üî∑ Shape Patterns</h2>
            <p style="text-align: center; color: #666; margin-bottom: 15px;">What shape comes next?</p>

            <div class="level-indicator">
                <span id="shapeLevelDisplay">Pattern 1 of 6</span>
            </div>

            <div class="shape-grid" id="shapeGrid"></div>

            <div class="feedback" id="shapeFeedback"></div>

            <div class="shape-options" id="shapeOptions"></div>

            <button class="next-btn" id="shapeNextBtn" onclick="nextShapeLevel()">Next Pattern ‚Üí</button>
        </div>

        <!-- Tab 3: Story Sequencing -->
        <div class="game-card hidden" id="storyTab">
            <h2>üìñ Story Order</h2>
            <p style="text-align: center; color: #666; margin-bottom: 15px;">Put the story in the right order! Tap cards 1, 2, 3, 4.</p>

            <div class="level-indicator">
                <span id="storyLevelDisplay">Story 1 of 4</span>
            </div>

            <div class="sequence-slots" id="sequenceSlots"></div>

            <div class="story-cards" id="storyCards"></div>

            <div class="feedback" id="storyFeedback"></div>

            <button class="next-btn" id="storyNextBtn" onclick="nextStory()">Next Story ‚Üí</button>
        </div>

        <!-- Tab 4: Growing Patterns -->
        <div class="game-card hidden" id="growTab">
            <h2>üìà Growing Patterns</h2>
            <p style="text-align: center; color: #666; margin-bottom: 15px;">How many blocks come next?</p>

            <div class="level-indicator">
                <span id="growLevelDisplay">Pattern 1 of 5</span>
            </div>

            <div class="grow-display" id="growDisplay"></div>

            <div class="feedback" id="growFeedback"></div>

            <div class="options-container" id="growOptions"></div>

            <button class="next-btn" id="growNextBtn" onclick="nextGrowLevel()">Next Pattern ‚Üí</button>
        </div>
    </div>

    <div class="celebration" id="celebration">
        <div class="celebration-content">
            <div class="trophy">üèÜ</div>
            <h2>PATTERN MASTER!</h2>
            <div class="stars-final" id="starsFinal">‚òÖ‚òÖ‚òÖ</div>
            <p>You found all the patterns!</p>
            <p>Patterns are everywhere - keep looking!</p>
            <a href="index.html" class="submit-btn">Play More Games!</a>
        </div>
    </div>

    <script>
        var audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            var osc = audioCtx.createOscillator();
            var gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if (type === 'correct') {
                osc.frequency.setValueAtTime(523, audioCtx.currentTime);
                osc.frequency.setValueAtTime(659, audioCtx.currentTime + 0.1);
                osc.frequency.setValueAtTime(784, audioCtx.currentTime + 0.2);
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                osc.start(); osc.stop(audioCtx.currentTime + 0.4);
            } else if (type === 'wrong') {
                osc.frequency.setValueAtTime(200, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.2);
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                osc.start(); osc.stop(audioCtx.currentTime + 0.2);
            } else if (type === 'star') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(800, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.3);
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                osc.start(); osc.stop(audioCtx.currentTime + 0.5);
            } else if (type === 'click') {
                osc.frequency.setValueAtTime(400, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start(); osc.stop(audioCtx.currentTime + 0.1);
            }
        }

        // Game State
        var currentLevel = 0;
        var score = 0;
        var streak = 0;
        var bestStreak = 0;
        var starsEarned = 0;
        var totalCorrect = 0;
        var currentTab = 'number';

        // Number Patterns - all hardcoded trusted data
        var numberPatterns = [
            { sequence: ['1', '2', '3', '4', '?'], answer: '5', options: ['5', '6', '4', '3'], hint: "Count up! 1, 2, 3, 4..." },
            { sequence: ['A', 'B', 'A', 'B', '?'], answer: 'A', options: ['A', 'B', 'C', 'D'], hint: "A-B-A-B repeats!" },
            { sequence: ['2', '4', '6', '8', '?'], answer: '10', options: ['10', '9', '11', '12'], hint: "Skip counting by 2s!" },
            { sequence: ['Red', 'Blue', 'Red', 'Blue', '?'], answer: 'Red', options: ['Red', 'Blue', 'Green', 'Yellow'], hint: "Red, Blue, Red, Blue..." },
            { sequence: ['5', '10', '15', '20', '?'], answer: '25', options: ['25', '30', '22', '21'], hint: "Skip counting by 5s!" },
            { sequence: ['1', '1', '2', '2', '?'], answer: '3', options: ['3', '2', '1', '4'], hint: "Each number appears twice!" },
            { sequence: ['Mon', 'Tue', 'Wed', 'Thu', '?'], answer: 'Fri', options: ['Sat', 'Fri', 'Sun', 'Mon'], hint: "Days of the week!" },
            { sequence: ['10', '9', '8', '7', '?'], answer: '6', options: ['6', '5', '8', '10'], hint: "Counting backwards!" }
        ];

        // Shape Patterns
        var shapeLevel = 0;
        var shapePatterns = [
            { sequence: ['üî¥', 'üîµ', 'üî¥', 'üîµ', '?'], answer: 'üî¥', options: ['üî¥', 'üîµ', 'üü¢', 'üü°'] },
            { sequence: ['‚≠ê', '‚≠ê', 'üåô', '‚≠ê', '‚≠ê', '?'], answer: 'üåô', options: ['‚≠ê', 'üåô', '‚òÄÔ∏è', 'üåü'] },
            { sequence: ['üî∫', 'üî∫', 'üîª', 'üî∫', 'üî∫', '?'], answer: 'üîª', options: ['üî∫', 'üîª', '‚¨õ', 'üî∑'] },
            { sequence: ['‚ù§Ô∏è', 'üíõ', 'üíö', '‚ù§Ô∏è', 'üíõ', '?'], answer: 'üíö', options: ['‚ù§Ô∏è', 'üíõ', 'üíö', 'üíú'] },
            { sequence: ['üü¶', 'üü¶', 'üü®', 'üü®', 'üü¶', '?'], answer: 'üü¶', options: ['üü¶', 'üü®', 'üü©', 'üü•'] },
            { sequence: ['üå∏', 'üå∫', 'üå∏', 'üå∫', 'üå∏', '?'], answer: 'üå∫', options: ['üå∏', 'üå∫', 'üåª', 'üå∑'] }
        ];

        // Story Sequences
        var storyLevel = 0;
        var storySlot = 0;
        var stories = [
            {
                title: "Making a Sandwich",
                cards: [
                    { emoji: 'üçû', label: 'Get bread', order: 0 },
                    { emoji: 'ü•ú', label: 'Add peanut butter', order: 1 },
                    { emoji: 'üçá', label: 'Add jelly', order: 2 },
                    { emoji: 'ü•™', label: 'Put together!', order: 3 }
                ]
            },
            {
                title: "Planting a Seed",
                cards: [
                    { emoji: 'üå±', label: 'Plant seed', order: 0 },
                    { emoji: 'üíß', label: 'Water it', order: 1 },
                    { emoji: '‚òÄÔ∏è', label: 'Sunshine', order: 2 },
                    { emoji: 'üåª', label: 'Flower grows!', order: 3 }
                ]
            },
            {
                title: "Getting Ready",
                cards: [
                    { emoji: 'üò¥', label: 'Wake up', order: 0 },
                    { emoji: 'ü™•', label: 'Brush teeth', order: 1 },
                    { emoji: 'üëï', label: 'Get dressed', order: 2 },
                    { emoji: 'üéí', label: 'Go to school!', order: 3 }
                ]
            },
            {
                title: "Baking Cookies",
                cards: [
                    { emoji: 'ü•£', label: 'Mix ingredients', order: 0 },
                    { emoji: 'üç™', label: 'Shape cookies', order: 1 },
                    { emoji: 'üî•', label: 'Bake them', order: 2 },
                    { emoji: 'üòã', label: 'Eat and enjoy!', order: 3 }
                ]
            }
        ];

        // Growing Patterns
        var growLevel = 0;
        var growPatterns = [
            { blocks: [1, 2, 3, 4], answer: 5, options: [5, 6, 4, 7] },
            { blocks: [2, 4, 6, 8], answer: 10, options: [10, 9, 12, 8] },
            { blocks: [1, 3, 5, 7], answer: 9, options: [8, 9, 10, 11] },
            { blocks: [3, 3, 3, 3], answer: 3, options: [3, 4, 6, 5] },
            { blocks: [1, 2, 4, 8], answer: 16, options: [16, 10, 12, 14] }
        ];

        function updateSpeech(text) {
            document.getElementById('speechBubble').textContent = text;
        }

        function updateProgress() {
            var percent = (totalCorrect / 23) * 100;
            document.getElementById('progressBar').style.width = Math.min(percent, 100) + '%';
        }

        function earnStar(num) {
            var star = document.getElementById('star' + num);
            if (!star.classList.contains('earned')) {
                star.classList.add('earned');
                starsEarned++;
                playSound('star');
            }
        }

        function showTab(tab) {
            playSound('click');
            currentTab = tab;

            document.querySelectorAll('.tab-btn').forEach(function(btn) { btn.classList.remove('active'); });
            event.target.classList.add('active');

            document.getElementById('numberTab').classList.add('hidden');
            document.getElementById('shapeTab').classList.add('hidden');
            document.getElementById('storyTab').classList.add('hidden');
            document.getElementById('growTab').classList.add('hidden');

            document.getElementById(tab + 'Tab').classList.remove('hidden');

            if (tab === 'number') {
                updateSpeech("Let's find number patterns!");
            } else if (tab === 'shape') {
                updateSpeech("Now let's do shape patterns!");
                loadShapeLevel();
            } else if (tab === 'story') {
                updateSpeech("Put the story in order!");
                loadStory();
            } else if (tab === 'grow') {
                updateSpeech("Watch the pattern grow!");
                loadGrowLevel();
            }
        }

        // ============ NUMBER PATTERNS ============
        function shuffle(array) {
            var arr = array.slice();
            for (var i = arr.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = arr[i];
                arr[i] = arr[j];
                arr[j] = temp;
            }
            return arr;
        }

        function displaySequence() {
            var pattern = numberPatterns[currentLevel];
            var container = document.getElementById('sequenceDisplay');
            while (container.firstChild) container.removeChild(container.firstChild);

            pattern.sequence.forEach(function(item, index) {
                var div = document.createElement('div');
                if (item === '?') {
                    div.className = 'sequence-item question-mark';
                } else {
                    div.className = 'sequence-item color-' + (index % 5);
                }
                div.textContent = item;
                container.appendChild(div);
            });

            updateSpeech(pattern.hint);
        }

        function displayOptions() {
            var pattern = numberPatterns[currentLevel];
            var container = document.getElementById('optionsContainer');
            while (container.firstChild) container.removeChild(container.firstChild);

            var shuffledOptions = shuffle(pattern.options);
            shuffledOptions.forEach(function(option) {
                var btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.onclick = function() { checkAnswer(option, btn); };
                container.appendChild(btn);
            });
        }

        function checkAnswer(selected, button) {
            var pattern = numberPatterns[currentLevel];
            var buttons = document.querySelectorAll('#optionsContainer .option-btn');
            buttons.forEach(function(btn) { btn.onclick = null; });

            var feedbackEl = document.getElementById('feedback');

            if (selected === pattern.answer) {
                button.classList.add('correct');
                score += 10 + (streak * 5);
                streak++;
                totalCorrect++;
                if (streak > bestStreak) bestStreak = streak;
                feedbackEl.textContent = 'üéâ Correct! Great pattern finding!';
                feedbackEl.className = 'feedback success';
                playSound('correct');
                updateSpeech("Excellent! You found the pattern!");

                if (totalCorrect === 5) earnStar(1);
                if (totalCorrect === 12) earnStar(2);
                if (totalCorrect === 20) earnStar(3);
            } else {
                button.classList.add('incorrect');
                buttons.forEach(function(btn) {
                    if (btn.textContent === pattern.answer) {
                        btn.classList.add('correct');
                    }
                });
                streak = 0;
                feedbackEl.textContent = 'The answer was ' + pattern.answer + '. Keep trying!';
                feedbackEl.className = 'feedback error';
                playSound('wrong');
                updateSpeech("That's okay! The answer was " + pattern.answer);
            }

            updateScore();
            updateProgress();
            document.getElementById('nextBtn').classList.add('show');
        }

        function updateScore() {
            document.getElementById('score').textContent = score;
            document.getElementById('streak').textContent = streak;
            document.getElementById('bestStreak').textContent = bestStreak;
        }

        function nextLevel() {
            currentLevel++;
            document.getElementById('feedback').textContent = '';
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('nextBtn').classList.remove('show');

            if (currentLevel >= numberPatterns.length) {
                currentLevel = 0;
                updateSpeech("You finished number patterns! Try shapes next!");
                document.querySelectorAll('.tab-btn')[1].click();
            } else {
                document.getElementById('levelDisplay').textContent = 'Level ' + (currentLevel + 1) + ' of ' + numberPatterns.length;
                displaySequence();
                displayOptions();
            }
        }

        // ============ SHAPE PATTERNS ============
        function loadShapeLevel() {
            var pattern = shapePatterns[shapeLevel];
            var grid = document.getElementById('shapeGrid');
            var options = document.getElementById('shapeOptions');
            while (grid.firstChild) grid.removeChild(grid.firstChild);
            while (options.firstChild) options.removeChild(options.firstChild);

            pattern.sequence.forEach(function(shape) {
                var div = document.createElement('div');
                div.className = 'shape-item';
                div.textContent = shape;
                grid.appendChild(div);
            });

            shuffle(pattern.options).forEach(function(opt) {
                var btn = document.createElement('button');
                btn.className = 'shape-option';
                btn.textContent = opt;
                btn.onclick = function() { checkShapeAnswer(opt, btn); };
                options.appendChild(btn);
            });

            document.getElementById('shapeLevelDisplay').textContent = 'Pattern ' + (shapeLevel + 1) + ' of ' + shapePatterns.length;
            document.getElementById('shapeFeedback').textContent = '';
            document.getElementById('shapeFeedback').className = 'feedback';
            document.getElementById('shapeNextBtn').classList.remove('show');
        }

        function checkShapeAnswer(selected, button) {
            var pattern = shapePatterns[shapeLevel];
            document.querySelectorAll('.shape-option').forEach(function(btn) { btn.onclick = null; });

            if (selected === pattern.answer) {
                button.classList.add('correct');
                totalCorrect++;
                score += 15;
                document.getElementById('shapeFeedback').textContent = 'üéâ Perfect! You got it!';
                document.getElementById('shapeFeedback').className = 'feedback success';
                playSound('correct');
                updateSpeech("Yes! " + selected + " comes next!");
                updateProgress();

                if (totalCorrect === 5) earnStar(1);
                if (totalCorrect === 12) earnStar(2);
                if (totalCorrect === 20) earnStar(3);
            } else {
                button.classList.add('wrong');
                document.getElementById('shapeFeedback').textContent = 'The answer was ' + pattern.answer;
                document.getElementById('shapeFeedback').className = 'feedback error';
                playSound('wrong');
            }

            document.getElementById('shapeNextBtn').classList.add('show');
        }

        function nextShapeLevel() {
            shapeLevel++;
            if (shapeLevel >= shapePatterns.length) {
                shapeLevel = 0;
                updateSpeech("Great job! Now try story sequencing!");
                document.querySelectorAll('.tab-btn')[2].click();
            } else {
                loadShapeLevel();
            }
        }

        // ============ STORY SEQUENCING ============
        function loadStory() {
            storySlot = 0;
            var story = stories[storyLevel];
            var cards = document.getElementById('storyCards');
            var slots = document.getElementById('sequenceSlots');

            while (cards.firstChild) cards.removeChild(cards.firstChild);
            while (slots.firstChild) slots.removeChild(slots.firstChild);

            for (var i = 0; i < 4; i++) {
                var slot = document.createElement('div');
                slot.className = 'sequence-slot';
                slot.textContent = i + 1;
                slot.id = 'slot' + i;
                slots.appendChild(slot);
            }

            shuffle(story.cards).forEach(function(card) {
                var div = document.createElement('div');
                div.className = 'story-card';

                var emojiSpan = document.createElement('span');
                emojiSpan.className = 'emoji';
                emojiSpan.textContent = card.emoji;

                var labelSpan = document.createElement('span');
                labelSpan.className = 'label';
                labelSpan.textContent = card.label;

                div.appendChild(emojiSpan);
                div.appendChild(labelSpan);
                div.onclick = function() { selectStoryCard(div, card.order, card.emoji); };
                div.dataset.order = card.order;
                cards.appendChild(div);
            });

            document.getElementById('storyLevelDisplay').textContent = 'Story ' + (storyLevel + 1) + ' of ' + stories.length + ': ' + story.title;
            document.getElementById('storyFeedback').textContent = '';
            document.getElementById('storyFeedback').className = 'feedback';
            document.getElementById('storyNextBtn').classList.remove('show');
            updateSpeech("What happens first in: " + story.title + "?");
        }

        function selectStoryCard(card, order, emoji) {
            if (card.classList.contains('placed')) return;

            if (order === storySlot) {
                card.classList.add('placed');
                var slot = document.getElementById('slot' + storySlot);
                slot.classList.add('filled');
                slot.textContent = emoji;
                storySlot++;
                playSound('correct');

                if (storySlot === 4) {
                    totalCorrect++;
                    score += 20;
                    document.getElementById('storyFeedback').textContent = 'üéâ Perfect sequence!';
                    document.getElementById('storyFeedback').className = 'feedback success';
                    updateSpeech("You put the story in perfect order!");
                    document.getElementById('storyNextBtn').classList.add('show');
                    updateProgress();

                    if (totalCorrect === 5) earnStar(1);
                    if (totalCorrect === 12) earnStar(2);
                    if (totalCorrect === 20) earnStar(3);
                } else {
                    updateSpeech("Good! What comes next?");
                }
            } else {
                card.classList.add('wrong');
                playSound('wrong');
                updateSpeech("Hmm, that's not the next step. Try again!");
                setTimeout(function() { card.classList.remove('wrong'); }, 500);
            }
        }

        function nextStory() {
            storyLevel++;
            if (storyLevel >= stories.length) {
                storyLevel = 0;
                updateSpeech("Amazing! Now try growing patterns!");
                document.querySelectorAll('.tab-btn')[3].click();
            } else {
                loadStory();
            }
        }

        // ============ GROWING PATTERNS ============
        function loadGrowLevel() {
            var pattern = growPatterns[growLevel];
            var display = document.getElementById('growDisplay');
            var options = document.getElementById('growOptions');

            while (display.firstChild) display.removeChild(display.firstChild);
            while (options.firstChild) options.removeChild(options.firstChild);

            pattern.blocks.forEach(function(count, idx) {
                var item = document.createElement('div');
                item.className = 'grow-item';

                var blocks = document.createElement('div');
                blocks.className = 'grow-blocks';
                for (var i = 0; i < count; i++) {
                    var block = document.createElement('div');
                    block.className = 'grow-block';
                    block.style.animationDelay = (idx * 0.1 + i * 0.05) + 's';
                    blocks.appendChild(block);
                }

                var label = document.createElement('div');
                label.className = 'grow-label';
                label.textContent = count;

                item.appendChild(blocks);
                item.appendChild(label);
                display.appendChild(item);
            });

            // Add question mark column
            var qItem = document.createElement('div');
            qItem.className = 'grow-item';
            var qMark = document.createElement('div');
            qMark.className = 'grow-question';
            qMark.textContent = '?';
            var qLabel = document.createElement('div');
            qLabel.className = 'grow-label';
            qLabel.textContent = '?';
            qItem.appendChild(qMark);
            qItem.appendChild(qLabel);
            display.appendChild(qItem);

            shuffle(pattern.options).forEach(function(opt) {
                var btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt;
                btn.onclick = function() { checkGrowAnswer(opt, btn); };
                options.appendChild(btn);
            });

            document.getElementById('growLevelDisplay').textContent = 'Pattern ' + (growLevel + 1) + ' of ' + growPatterns.length;
            document.getElementById('growFeedback').textContent = '';
            document.getElementById('growFeedback').className = 'feedback';
            document.getElementById('growNextBtn').classList.remove('show');
        }

        function checkGrowAnswer(selected, button) {
            var pattern = growPatterns[growLevel];
            document.querySelectorAll('#growOptions .option-btn').forEach(function(btn) { btn.onclick = null; });

            if (selected === pattern.answer) {
                button.classList.add('correct');
                totalCorrect++;
                score += 15;
                document.getElementById('growFeedback').textContent = 'üéâ Correct! ' + pattern.answer + ' blocks come next!';
                document.getElementById('growFeedback').className = 'feedback success';
                playSound('correct');
                updateSpeech("Yes! The pattern grows to " + pattern.answer + "!");
                updateProgress();

                if (totalCorrect === 5) earnStar(1);
                if (totalCorrect === 12) earnStar(2);
                if (totalCorrect === 20) earnStar(3);
            } else {
                button.classList.add('incorrect');
                document.getElementById('growFeedback').textContent = 'The answer was ' + pattern.answer;
                document.getElementById('growFeedback').className = 'feedback error';
                playSound('wrong');
            }

            document.getElementById('growNextBtn').classList.add('show');
        }

        function nextGrowLevel() {
            growLevel++;
            if (growLevel >= growPatterns.length) {
                showCelebration();
            } else {
                loadGrowLevel();
            }
        }

        function showCelebration() {
            document.getElementById('celebration').classList.add('show');
            document.getElementById('starsFinal').textContent = '‚òÖ'.repeat(starsEarned) + '‚òÜ'.repeat(3 - starsEarned);
            launchConfetti();
        }

        function launchConfetti() {
            var colors = ['#667eea', '#764ba2', '#FFD700', '#4ECDC4', '#FF6B6B'];
            for (var i = 0; i < 50; i++) {
                (function(idx) {
                    setTimeout(function() {
                        var confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + 'vw';
                        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                        document.body.appendChild(confetti);
                        setTimeout(function() { confetti.remove(); }, 3000);
                    }, idx * 50);
                })(i);
            }
        }

        // Initialize
        displaySequence();
        displayOptions();
    </script>
</body>
</html>
