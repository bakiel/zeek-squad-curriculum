<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Types of Plants - Zeek Squad</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        .container { max-width: 600px; margin: 0 auto; }
        .header { text-align: center; color: white; margin-bottom: 20px; }
        .header h1 { font-size: 1.8rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }

        .back-btn { display: inline-block; background: rgba(255,255,255,0.2); color: white; text-decoration: none; padding: 8px 20px; border-radius: 20px; font-size: 0.9rem; margin-bottom: 15px; transition: all 0.3s; cursor: pointer; }
        .back-btn:hover { background: rgba(255,255,255,0.3); }

        .mascot { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .mascot-emoji { font-size: 4rem; animation: plantGrow 2s ease-in-out infinite; }
        @keyframes plantGrow { 0%, 100% { transform: scaleY(1) rotate(-3deg); } 50% { transform: scaleY(1.1) rotate(3deg); } }
        .speech-bubble { background: white; padding: 15px 20px; border-radius: 20px; flex: 1; position: relative; font-size: 1.1rem; color: #333; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .speech-bubble:before { content: ''; position: absolute; left: -10px; top: 50%; transform: translateY(-50%); border: 10px solid transparent; border-right-color: white; }

        .progress-container { background: rgba(255,255,255,0.3); border-radius: 10px; height: 12px; margin: 15px 0; overflow: hidden; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #FFD700, #FFA500); border-radius: 10px; transition: width 0.5s ease; width: 0%; }

        .stars { text-align: center; font-size: 2rem; margin-bottom: 15px; }
        .star { color: rgba(255,255,255,0.3); transition: all 0.5s; display: inline-block; }
        .star.earned { color: #FFD700; animation: starEarn 0.6s ease; filter: drop-shadow(0 0 10px #FFD700); }
        @keyframes starEarn { 0% { transform: scale(0) rotate(-180deg); } 60% { transform: scale(1.5) rotate(20deg); } 100% { transform: scale(1) rotate(0deg); } }

        .tab-nav { display: flex; gap: 5px; margin-bottom: 15px; flex-wrap: wrap; justify-content: center; }
        .tab-btn { padding: 10px 12px; border: none; background: rgba(255,255,255,0.2); color: white; border-radius: 10px; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; font-family: inherit; }
        .tab-btn:hover { background: rgba(255,255,255,0.3); }
        .tab-btn.active { background: white; color: #27ae60; font-weight: bold; }
        .tab-btn.completed::after { content: ' ‚úì'; }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .game-area { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .question-counter { text-align: center; color: #666; margin-bottom: 15px; font-size: 1rem; }

        .round-indicator { display: flex; justify-content: center; gap: 8px; margin-bottom: 15px; }
        .round-dot { width: 12px; height: 12px; border-radius: 50%; background: #e0e0e0; transition: all 0.3s; }
        .round-dot.active { background: #27ae60; transform: scale(1.2); }
        .round-dot.completed { background: #FFD700; }

        .instruction { background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%); color: white; padding: 15px 20px; border-radius: 15px; text-align: center; margin-bottom: 20px; font-size: 1.1rem; }

        /* Plant Parts */
        .plant-diagram { text-align: center; margin: 20px 0; }
        .plant-visual { position: relative; width: 220px; height: 280px; margin: 0 auto; }
        .plant-part-btn { position: absolute; cursor: pointer; transition: all 0.3s; border: none; background: transparent; padding: 10px; border-radius: 10px; }
        .plant-part-btn:hover { background: rgba(39, 174, 96, 0.2); transform: scale(1.1); }
        .plant-part-btn.highlighted { background: rgba(39, 174, 96, 0.3); animation: pulse 0.5s ease; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }
        .part-emoji { font-size: 2.5rem; display: block; }
        .part-label { font-size: 0.8rem; color: #666; }

        /* Quiz Buttons */
        .quiz-options { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px; }
        .quiz-btn { padding: 15px; border: 3px solid #e0e0e0; background: white; border-radius: 12px; font-size: 1rem; cursor: pointer; font-family: inherit; transition: all 0.3s; text-align: center; }
        .quiz-btn:hover { border-color: #27ae60; background: #f0fff0; transform: scale(1.02); }
        .quiz-btn.correct { border-color: #27ae60; background: #d5f5e3; }
        .quiz-btn.wrong { border-color: #e74c3c; background: #fadbd8; }
        .quiz-btn .btn-emoji { font-size: 2rem; display: block; margin-bottom: 5px; }

        /* Sort Game */
        .sort-container { display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; }
        .sort-zone { flex: 1; min-width: 100px; background: #f8f9fa; border-radius: 15px; padding: 12px; min-height: 150px; border: 3px dashed #ddd; transition: all 0.3s; cursor: pointer; }
        .sort-zone:hover { border-color: #27ae60; background: #e8f5e9; }
        .sort-zone h3 { text-align: center; color: #27ae60; margin-bottom: 8px; font-size: 0.9rem; }
        .sort-zone .emoji { font-size: 1.8rem; text-align: center; display: block; }
        .sort-zone .sorted-items { margin-top: 10px; display: flex; flex-wrap: wrap; gap: 5px; justify-content: center; }
        .sorted-item { font-size: 1.5rem; }

        .draggable-items { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 20px; }
        .drag-item { padding: 10px 15px; background: white; border-radius: 10px; cursor: grab; box-shadow: 0 3px 10px rgba(0,0,0,0.1); transition: all 0.3s; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; border: 2px solid transparent; }
        .drag-item:hover { transform: scale(1.05); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .drag-item.selected { border-color: #27ae60; background: #e8f5e9; }
        .drag-item .item-emoji { font-size: 1.3rem; }
        .drag-item.correct { background: #d5f5e3; border: 2px solid #27ae60; pointer-events: none; }
        .drag-item.wrong { background: #fadbd8; border: 2px solid #e74c3c; animation: wrongShake 0.5s ease; }
        @keyframes wrongShake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }

        /* Life Cycle */
        .lifecycle-container { text-align: center; }
        .lifecycle-title { font-size: 1.2rem; color: #27ae60; font-weight: bold; margin-bottom: 15px; }
        .lifecycle-stages { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; margin: 20px 0; }
        .stage-slot { width: 75px; height: 95px; border: 3px dashed #27ae60; border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.8rem; color: #666; background: #f8f9fa; transition: all 0.3s; }
        .stage-slot.filled { border-style: solid; background: #d5f5e3; }
        .stage-slot .stage-emoji { font-size: 2rem; }
        .stage-slot .stage-label { font-size: 0.7rem; margin-top: 3px; text-align: center; }

        .stage-options { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
        .stage-option { padding: 10px 12px; background: white; border-radius: 10px; cursor: pointer; box-shadow: 0 3px 10px rgba(0,0,0,0.1); transition: all 0.3s; display: flex; flex-direction: column; align-items: center; border: 2px solid transparent; }
        .stage-option:hover { transform: scale(1.05); background: #e8f5e9; }
        .stage-option .opt-emoji { font-size: 1.8rem; }
        .stage-option .opt-label { font-size: 0.75rem; margin-top: 3px; }
        .stage-option.used { opacity: 0.4; pointer-events: none; }
        .stage-option.wrong { border-color: #e74c3c; animation: wrongShake 0.3s; }

        /* Plant Needs */
        .needs-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0; }
        .need-card { background: #f8f9fa; padding: 20px; border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s; border: 3px solid transparent; }
        .need-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .need-card .need-emoji { font-size: 2.5rem; margin-bottom: 8px; }
        .need-card .need-label { font-size: 1rem; font-weight: bold; color: #333; }
        .need-card.correct { background: #d5f5e3; border-color: #27ae60; pointer-events: none; }
        .need-card.wrong { background: #fadbd8; border-color: #e74c3c; }

        /* Plant fact card */
        .fact-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 15px; margin-top: 20px; text-align: center; }
        .fact-card h4 { font-size: 1rem; margin-bottom: 10px; opacity: 0.9; }
        .fact-card p { font-size: 1.1rem; }

        .celebration { display: none; text-align: center; padding: 30px; }
        .celebration.show { display: block; animation: celebrationPop 0.5s ease; }
        @keyframes celebrationPop { 0% { transform: scale(0); } 60% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .celebration h2 { font-size: 2rem; color: #27ae60; margin-bottom: 15px; }
        .celebration .trophy { font-size: 5rem; animation: trophyBounce 1s ease infinite; }
        @keyframes trophyBounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        .final-score { font-size: 1.5rem; color: #666; margin: 15px 0; }
        .final-stars { font-size: 3rem; margin: 15px 0; }

        .confetti { position: fixed; width: 10px; height: 10px; top: -10px; animation: confettiFall 3s ease-out forwards; pointer-events: none; }
        @keyframes confettiFall { to { top: 100vh; transform: rotate(720deg); } }

        .next-btn { display: block; width: 100%; padding: 15px; background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: white; border: none; border-radius: 10px; font-size: 1.2rem; cursor: pointer; font-family: inherit; margin-top: 15px; transition: all 0.3s; }
        .next-btn:hover { transform: scale(1.02); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="container">
        <a href="../../index.html" class="back-btn">‚Üê Back to Games</a>
        <div class="header"><h1>üå± Types of Plants!</h1></div>

        <div class="mascot">
            <div class="mascot-emoji">üåª</div>
            <div class="speech-bubble" id="mascotMessage">Hi friend! I am Sunny the Sunflower! Let us learn about plants together! Plants are living things that grow!</div>
        </div>

        <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>
        <div class="stars">
            <span class="star" id="star1">‚≠ê</span>
            <span class="star" id="star2">‚≠ê</span>
            <span class="star" id="star3">‚≠ê</span>
        </div>

        <div class="tab-nav">
            <button class="tab-btn active" data-tab="parts">üåø Parts</button>
            <button class="tab-btn" data-tab="types">üå≥ Types</button>
            <button class="tab-btn" data-tab="lifecycle">üîÑ Life</button>
            <button class="tab-btn" data-tab="needs">üíß Needs</button>
        </div>

        <div class="tab-content active" id="parts-tab">
            <div class="game-area">
                <div class="instruction">Learn the parts of a plant!</div>
                <div class="round-indicator" id="partsRounds"></div>
                <div class="question-counter" id="partsCounter">Question 1 of 8</div>
                <div id="partsContent"></div>
            </div>
        </div>

        <div class="tab-content" id="types-tab">
            <div class="game-area">
                <div class="instruction">Sort the plants into the right groups!</div>
                <div class="round-indicator" id="typesRounds"></div>
                <div class="question-counter" id="typesCounter">Round 1: Sorted 0 / 6</div>
                <div id="typesContent"></div>
            </div>
        </div>

        <div class="tab-content" id="lifecycle-tab">
            <div class="game-area">
                <div class="instruction">Put the plant life cycle in order!</div>
                <div class="round-indicator" id="lifecycleRounds"></div>
                <div class="question-counter" id="lifecycleCounter">Life Cycle 1 of 3</div>
                <div class="lifecycle-container" id="lifecycleContent"></div>
            </div>
        </div>

        <div class="tab-content" id="needs-tab">
            <div class="game-area">
                <div class="instruction">What do plants need to grow?</div>
                <div class="round-indicator" id="needsRounds"></div>
                <div class="question-counter" id="needsCounter">Round 1 of 3</div>
                <div id="needsContent"></div>
            </div>
        </div>

        <div class="celebration" id="celebration">
            <div class="trophy">üèÜ</div>
            <h2>Plant Expert!</h2>
            <p>You learned all about plants!</p>
            <div class="final-stars" id="finalStars"></div>
            <div class="final-score" id="finalScore"></div>
            <button class="next-btn" onclick="location.reload()">Play Again!</button>
        </div>
    </div>

    <script>
        function clearChildren(element) {
            while (element.firstChild) {
                element.removeChild(element.firstChild);
            }
        }

        var audioContext = null;
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playSound(type) {
            initAudio();
            var oscillator = audioContext.createOscillator();
            var gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            if (type === 'correct') {
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            } else if (type === 'wrong') {
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(150, audioContext.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            } else if (type === 'star') {
                oscillator.frequency.setValueAtTime(880, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(1108.73, audioContext.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            } else if (type === 'click') {
                oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            } else if (type === 'complete') {
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.15);
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.3);
                oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.45);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            }

            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        var totalScore = 0;
        var maxScore = 48;
        var starsEarned = 0;
        var tabsCompleted = { parts: false, types: false, lifecycle: false, needs: false };

        // Tab navigation
        document.querySelectorAll('.tab-btn').forEach(function(btn) {
            btn.addEventListener('click', function() {
                playSound('click');
                var tabId = this.getAttribute('data-tab');
                document.querySelectorAll('.tab-btn').forEach(function(b) { b.classList.remove('active'); });
                document.querySelectorAll('.tab-content').forEach(function(c) { c.classList.remove('active'); });
                this.classList.add('active');
                document.getElementById(tabId + '-tab').classList.add('active');
            });
        });

        function updateProgress() {
            var percent = (totalScore / maxScore) * 100;
            document.getElementById('progressBar').style.width = Math.min(percent, 100) + '%';

            if (percent >= 33 && starsEarned < 1) {
                starsEarned = 1;
                document.getElementById('star1').classList.add('earned');
                playSound('star');
            }
            if (percent >= 66 && starsEarned < 2) {
                starsEarned = 2;
                document.getElementById('star2').classList.add('earned');
                playSound('star');
            }
            if (percent >= 100 && starsEarned < 3) {
                starsEarned = 3;
                document.getElementById('star3').classList.add('earned');
                playSound('star');
            }
        }

        function updateMascot(message) {
            document.getElementById('mascotMessage').textContent = message;
        }

        function markTabComplete(tabName) {
            tabsCompleted[tabName] = true;
            document.querySelector('[data-tab="' + tabName + '"]').classList.add('completed');
            checkAllComplete();
        }

        function checkAllComplete() {
            if (tabsCompleted.parts && tabsCompleted.types && tabsCompleted.lifecycle && tabsCompleted.needs) {
                setTimeout(showCelebration, 500);
            }
        }

        function showCelebration() {
            playSound('complete');
            document.getElementById('celebration').classList.add('show');

            var starsHtml = '';
            for (var i = 0; i < starsEarned; i++) { starsHtml += '‚≠ê'; }
            for (var j = starsEarned; j < 3; j++) { starsHtml += '‚òÜ'; }
            document.getElementById('finalStars').textContent = starsHtml;
            document.getElementById('finalScore').textContent = 'Score: ' + totalScore + ' / ' + maxScore;

            var colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#27ae60', '#FF8E53', '#a8e6cf'];
            for (var k = 0; k < 60; k++) {
                (function(index) {
                    setTimeout(function() {
                        var confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + 'vw';
                        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                        document.body.appendChild(confetti);
                        setTimeout(function() {
                            if (confetti.parentNode) confetti.parentNode.removeChild(confetti);
                        }, 3000);
                    }, index * 40);
                })(k);
            }
        }

        function createRoundDots(containerId, total, current) {
            var container = document.getElementById(containerId);
            clearChildren(container);
            for (var i = 0; i < total; i++) {
                var dot = document.createElement('div');
                dot.className = 'round-dot';
                if (i < current) dot.classList.add('completed');
                if (i === current) dot.classList.add('active');
                container.appendChild(dot);
            }
        }

        // =====================
        // PARTS TAB - Enhanced
        // =====================
        var partsQuestions = [
            { type: 'diagram', part: 'roots', emoji: 'üå±', hint: 'They grow underground!' },
            { type: 'diagram', part: 'stem', emoji: 'üåø', hint: 'It holds the plant up!' },
            { type: 'diagram', part: 'leaves', emoji: 'üçÉ', hint: 'They make food from sunlight!' },
            { type: 'diagram', part: 'flower', emoji: 'üå∏', hint: 'It makes seeds!' },
            { type: 'quiz', question: 'Which part drinks water from the soil?', answer: 'Roots', options: ['Roots', 'Leaves', 'Flower', 'Stem'], emoji: 'üíß' },
            { type: 'quiz', question: 'Which part makes food using sunlight?', answer: 'Leaves', options: ['Stem', 'Roots', 'Leaves', 'Flower'], emoji: '‚òÄÔ∏è' },
            { type: 'quiz', question: 'Which part holds the plant up tall?', answer: 'Stem', options: ['Flower', 'Stem', 'Roots', 'Leaves'], emoji: 'üìè' },
            { type: 'quiz', question: 'Which part makes seeds for new plants?', answer: 'Flower', options: ['Leaves', 'Roots', 'Stem', 'Flower'], emoji: 'üå±' }
        ];

        var partsDescriptions = {
            roots: 'Roots grow underground and drink water for the plant!',
            stem: 'The stem is like a straw that carries water up to the leaves!',
            leaves: 'Leaves are like little food factories using sunlight!',
            flower: 'The flower makes seeds that grow into new plants!'
        };

        var partEmojis = {
            flower: 'üå∏',
            leaves: 'üçÉ',
            stem: 'üåø',
            roots: 'üå±'
        };

        var currentPartsQuestion = 0;
        var partsCorrect = 0;

        function initPartsTab() {
            createRoundDots('partsRounds', partsQuestions.length, 0);
            showPartsQuestion();
        }

        function showPartsQuestion() {
            var content = document.getElementById('partsContent');
            clearChildren(content);

            if (currentPartsQuestion >= partsQuestions.length) {
                markTabComplete('parts');
                totalScore += 4;
                updateProgress();
                updateMascot('Amazing! You know all the plant parts! Roots, stem, leaves, and flower work together!');

                var msg = document.createElement('div');
                msg.className = 'fact-card';

                var h4 = document.createElement('h4');
                h4.textContent = 'üéâ Parts Complete!';
                msg.appendChild(h4);

                var p = document.createElement('p');
                p.textContent = 'Plants have 4 main parts that all work together to help the plant grow and make new plants!';
                msg.appendChild(p);

                content.appendChild(msg);
                return;
            }

            document.getElementById('partsCounter').textContent = 'Question ' + (currentPartsQuestion + 1) + ' of ' + partsQuestions.length;
            createRoundDots('partsRounds', partsQuestions.length, currentPartsQuestion);

            var q = partsQuestions[currentPartsQuestion];

            if (q.type === 'diagram') {
                showDiagramQuestion(content, q);
            } else {
                showPartsQuiz(content, q);
            }
        }

        function showDiagramQuestion(content, q) {
            var questionDiv = document.createElement('div');
            questionDiv.id = 'partQuestion';
            questionDiv.style.cssText = 'text-align: center; font-size: 1.3rem; font-weight: bold; color: #27ae60; margin-bottom: 15px;';
            questionDiv.textContent = 'Tap the ' + q.part.toUpperCase() + '!';
            content.appendChild(questionDiv);

            var hint = document.createElement('div');
            hint.style.cssText = 'text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 10px;';
            hint.textContent = 'Hint: ' + q.hint;
            content.appendChild(hint);

            var diagramDiv = document.createElement('div');
            diagramDiv.className = 'plant-diagram';

            var plantVisual = document.createElement('div');
            plantVisual.className = 'plant-visual';

            // Create part buttons with emojis instead of SVG
            var parts = [
                { name: 'flower', emoji: 'üå∏', top: '10px', left: '75px' },
                { name: 'leaves', emoji: 'üçÉ', top: '80px', left: '30px' },
                { name: 'stem', emoji: 'üåø', top: '130px', left: '85px' },
                { name: 'roots', emoji: 'üå±', top: '200px', left: '70px' }
            ];

            parts.forEach(function(part) {
                var btn = document.createElement('button');
                btn.className = 'plant-part-btn';
                btn.id = 'part-' + part.name;
                btn.style.top = part.top;
                btn.style.left = part.left;

                var emoji = document.createElement('span');
                emoji.className = 'part-emoji';
                emoji.textContent = part.emoji;
                btn.appendChild(emoji);

                var label = document.createElement('span');
                label.className = 'part-label';
                label.textContent = part.name.charAt(0).toUpperCase() + part.name.slice(1);
                btn.appendChild(label);

                btn.onclick = function() { checkDiagramPart(part.name, q.part); };
                plantVisual.appendChild(btn);
            });

            diagramDiv.appendChild(plantVisual);
            content.appendChild(diagramDiv);
        }

        function checkDiagramPart(clicked, correct) {
            var partBtn = document.getElementById('part-' + clicked);

            if (clicked === correct) {
                if (partBtn) partBtn.classList.add('highlighted');
                partsCorrect++;
                totalScore++;
                playSound('correct');
                updateMascot('Correct! ' + partsDescriptions[clicked]);
                updateProgress();
                currentPartsQuestion++;
                setTimeout(showPartsQuestion, 1200);
            } else {
                playSound('wrong');
                updateMascot('That is the ' + clicked + '. Try to find the ' + correct + '!');
            }
        }

        function showPartsQuiz(content, q) {
            var questionDiv = document.createElement('div');
            questionDiv.style.cssText = 'text-align: center; font-size: 1.2rem; font-weight: bold; color: #333; margin: 20px 0;';

            var emoji = document.createElement('div');
            emoji.style.fontSize = '3rem';
            emoji.textContent = q.emoji;
            questionDiv.appendChild(emoji);

            var text = document.createElement('div');
            text.textContent = q.question;
            questionDiv.appendChild(text);

            content.appendChild(questionDiv);

            var options = document.createElement('div');
            options.className = 'quiz-options';

            var shuffled = q.options.slice().sort(function() { return Math.random() - 0.5; });
            shuffled.forEach(function(opt) {
                var btn = document.createElement('button');
                btn.className = 'quiz-btn';
                btn.textContent = opt;
                btn.onclick = function() { checkPartsQuiz(btn, opt, q.answer, options); };
                options.appendChild(btn);
            });

            content.appendChild(options);
        }

        function checkPartsQuiz(btn, selected, correct, container) {
            var buttons = container.querySelectorAll('.quiz-btn');
            buttons.forEach(function(b) { b.style.pointerEvents = 'none'; });

            if (selected === correct) {
                btn.classList.add('correct');
                partsCorrect++;
                totalScore++;
                playSound('correct');
                updateMascot('Correct! ' + correct + ' is the right answer!');
                updateProgress();
            } else {
                btn.classList.add('wrong');
                buttons.forEach(function(b) {
                    if (b.textContent === correct) b.classList.add('correct');
                });
                playSound('wrong');
                updateMascot('The answer is ' + correct + '. Keep learning!');
            }

            currentPartsQuestion++;
            setTimeout(showPartsQuestion, 1500);
        }

        // =====================
        // TYPES TAB - Enhanced
        // =====================
        var typesRounds = [
            {
                categories: [
                    { name: 'Trees', emoji: 'üå≥' },
                    { name: 'Flowers', emoji: 'üå∏' }
                ],
                plants: [
                    { emoji: 'üå≤', name: 'Pine', type: 'Trees' },
                    { emoji: 'üå≥', name: 'Oak', type: 'Trees' },
                    { emoji: 'üå¥', name: 'Palm', type: 'Trees' },
                    { emoji: 'üå∑', name: 'Tulip', type: 'Flowers' },
                    { emoji: 'üåπ', name: 'Rose', type: 'Flowers' },
                    { emoji: 'üåª', name: 'Sunflower', type: 'Flowers' }
                ]
            },
            {
                categories: [
                    { name: 'Vegetables', emoji: 'ü•¨' },
                    { name: 'Fruits', emoji: 'üçé' }
                ],
                plants: [
                    { emoji: 'ü•ï', name: 'Carrot', type: 'Vegetables' },
                    { emoji: 'ü•¨', name: 'Lettuce', type: 'Vegetables' },
                    { emoji: 'ü•¶', name: 'Broccoli', type: 'Vegetables' },
                    { emoji: 'üçé', name: 'Apple', type: 'Fruits' },
                    { emoji: 'üçä', name: 'Orange', type: 'Fruits' },
                    { emoji: 'üçá', name: 'Grapes', type: 'Fruits' }
                ]
            },
            {
                categories: [
                    { name: 'Big Plants', emoji: 'üå≤' },
                    { name: 'Small Plants', emoji: 'üå±' }
                ],
                plants: [
                    { emoji: 'üå≥', name: 'Oak Tree', type: 'Big Plants' },
                    { emoji: 'üå¥', name: 'Palm Tree', type: 'Big Plants' },
                    { emoji: 'üå≤', name: 'Pine Tree', type: 'Big Plants' },
                    { emoji: 'üå∑', name: 'Tulip', type: 'Small Plants' },
                    { emoji: 'üå±', name: 'Seedling', type: 'Small Plants' },
                    { emoji: 'üçÄ', name: 'Clover', type: 'Small Plants' }
                ]
            }
        ];

        var currentTypesRound = 0;
        var selectedPlant = null;
        var sortedInRound = 0;
        var typesCorrect = 0;

        function initTypesTab() {
            createRoundDots('typesRounds', typesRounds.length, 0);
            showTypesRound();
        }

        function showTypesRound() {
            var content = document.getElementById('typesContent');
            clearChildren(content);
            selectedPlant = null;
            sortedInRound = 0;

            if (currentTypesRound >= typesRounds.length) {
                markTabComplete('types');
                totalScore += 4;
                updateProgress();
                updateMascot('Fantastic! You can sort all kinds of plants! Trees, flowers, fruits, and vegetables!');

                var msg = document.createElement('div');
                msg.className = 'fact-card';

                var h4 = document.createElement('h4');
                h4.textContent = 'üéâ Sorting Complete!';
                msg.appendChild(h4);

                var p = document.createElement('p');
                p.textContent = 'There are many types of plants - trees that grow tall, flowers that are beautiful, and plants we can eat!';
                msg.appendChild(p);

                content.appendChild(msg);
                return;
            }

            var round = typesRounds[currentTypesRound];
            createRoundDots('typesRounds', typesRounds.length, currentTypesRound);
            document.getElementById('typesCounter').textContent = 'Round ' + (currentTypesRound + 1) + ': Sorted 0 / ' + round.plants.length;

            // Create categories
            var sortContainer = document.createElement('div');
            sortContainer.className = 'sort-container';

            round.categories.forEach(function(cat) {
                var zone = document.createElement('div');
                zone.className = 'sort-zone';
                zone.id = 'zone-' + cat.name.replace(/\s/g, '-');

                var emoji = document.createElement('span');
                emoji.className = 'emoji';
                emoji.textContent = cat.emoji;
                zone.appendChild(emoji);

                var title = document.createElement('h3');
                title.textContent = cat.name;
                zone.appendChild(title);

                var sortedDiv = document.createElement('div');
                sortedDiv.className = 'sorted-items';
                sortedDiv.id = 'sorted-' + cat.name.replace(/\s/g, '-');
                zone.appendChild(sortedDiv);

                zone.onclick = function() { sortToCategory(cat.name); };
                sortContainer.appendChild(zone);
            });

            content.appendChild(sortContainer);

            // Create plant items
            var itemsContainer = document.createElement('div');
            itemsContainer.className = 'draggable-items';
            itemsContainer.id = 'plantItems';

            var shuffled = round.plants.slice().sort(function() { return Math.random() - 0.5; });
            shuffled.forEach(function(plant, index) {
                var item = document.createElement('div');
                item.className = 'drag-item';
                item.id = 'plant-' + currentTypesRound + '-' + index;

                var emojiSpan = document.createElement('span');
                emojiSpan.className = 'item-emoji';
                emojiSpan.textContent = plant.emoji;
                item.appendChild(emojiSpan);

                var nameText = document.createTextNode(plant.name);
                item.appendChild(nameText);

                item.onclick = function() { selectPlantItem(plant, item); };
                itemsContainer.appendChild(item);
            });

            content.appendChild(itemsContainer);
        }

        function selectPlantItem(plant, element) {
            if (element.classList.contains('correct')) return;

            document.querySelectorAll('.drag-item').forEach(function(el) {
                el.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedPlant = { plant: plant, element: element };
            updateMascot('Good! Now tap the right category for ' + plant.name + '!');
            playSound('click');
        }

        function sortToCategory(categoryName) {
            if (!selectedPlant) {
                updateMascot('First tap a plant to select it!');
                return;
            }

            var round = typesRounds[currentTypesRound];

            if (selectedPlant.plant.type === categoryName) {
                selectedPlant.element.classList.remove('selected');
                selectedPlant.element.classList.add('correct');

                var sortedDiv = document.getElementById('sorted-' + categoryName.replace(/\s/g, '-'));
                var sortedEmoji = document.createElement('span');
                sortedEmoji.className = 'sorted-item';
                sortedEmoji.textContent = selectedPlant.plant.emoji;
                sortedDiv.appendChild(sortedEmoji);

                sortedInRound++;
                typesCorrect++;
                totalScore++;
                playSound('correct');
                updateMascot('Correct! ' + selectedPlant.plant.name + ' is a ' + categoryName.toLowerCase() + '!');
                document.getElementById('typesCounter').textContent = 'Round ' + (currentTypesRound + 1) + ': Sorted ' + sortedInRound + ' / ' + round.plants.length;
                updateProgress();

                if (sortedInRound >= round.plants.length) {
                    currentTypesRound++;
                    setTimeout(showTypesRound, 1000);
                }
            } else {
                selectedPlant.element.classList.add('wrong');
                playSound('wrong');
                updateMascot(selectedPlant.plant.name + ' is not in ' + categoryName + '. Try again!');
                setTimeout(function() {
                    if (selectedPlant && selectedPlant.element) {
                        selectedPlant.element.classList.remove('wrong');
                        selectedPlant.element.classList.remove('selected');
                    }
                }, 500);
            }

            selectedPlant = null;
        }

        // =====================
        // LIFECYCLE TAB - Enhanced
        // =====================
        var lifecycleRoundsData = [
            {
                title: 'Flower Life Cycle',
                stages: [
                    { emoji: 'üå±', label: 'Seed', order: 1 },
                    { emoji: 'üåø', label: 'Sprout', order: 2 },
                    { emoji: 'ü™¥', label: 'Plant', order: 3 },
                    { emoji: 'üå∏', label: 'Flower', order: 4 }
                ]
            },
            {
                title: 'Fruit Tree Life Cycle',
                stages: [
                    { emoji: 'üå∞', label: 'Seed', order: 1 },
                    { emoji: 'üå±', label: 'Seedling', order: 2 },
                    { emoji: 'üå≥', label: 'Tree', order: 3 },
                    { emoji: 'üçé', label: 'Fruit', order: 4 }
                ]
            },
            {
                title: 'Vegetable Life Cycle',
                stages: [
                    { emoji: 'üå±', label: 'Seed', order: 1 },
                    { emoji: 'üåø', label: 'Sprout', order: 2 },
                    { emoji: 'ü•¨', label: 'Plant', order: 3 },
                    { emoji: 'ü•ï', label: 'Vegetable', order: 4 }
                ]
            }
        ];

        var currentLifecycleRound = 0;
        var currentSlot = 0;
        var lifecycleCorrect = 0;

        function initLifecycleTab() {
            createRoundDots('lifecycleRounds', lifecycleRoundsData.length, 0);
            showLifecycleRound();
        }

        function showLifecycleRound() {
            var content = document.getElementById('lifecycleContent');
            clearChildren(content);
            currentSlot = 0;

            if (currentLifecycleRound >= lifecycleRoundsData.length) {
                markTabComplete('lifecycle');
                totalScore += 4;
                updateProgress();
                updateMascot('Amazing! You understand how plants grow! From seed to plant to flower!');

                var msg = document.createElement('div');
                msg.className = 'fact-card';

                var h4 = document.createElement('h4');
                h4.textContent = 'üéâ Life Cycles Complete!';
                msg.appendChild(h4);

                var p = document.createElement('p');
                p.textContent = 'All plants follow a life cycle: seed, sprout, plant, flower or fruit, then new seeds!';
                msg.appendChild(p);

                content.appendChild(msg);
                return;
            }

            var round = lifecycleRoundsData[currentLifecycleRound];
            createRoundDots('lifecycleRounds', lifecycleRoundsData.length, currentLifecycleRound);
            document.getElementById('lifecycleCounter').textContent = 'Life Cycle ' + (currentLifecycleRound + 1) + ' of ' + lifecycleRoundsData.length;

            var title = document.createElement('div');
            title.className = 'lifecycle-title';
            title.textContent = round.title;
            content.appendChild(title);

            // Create slots
            var slotsContainer = document.createElement('div');
            slotsContainer.className = 'lifecycle-stages';
            slotsContainer.id = 'lifecycleSlots';

            for (var i = 0; i < round.stages.length; i++) {
                var slot = document.createElement('div');
                slot.className = 'stage-slot';
                slot.id = 'slot-' + i;

                var num = document.createElement('span');
                num.textContent = (i + 1);
                slot.appendChild(num);

                slotsContainer.appendChild(slot);
            }

            content.appendChild(slotsContainer);

            // Create options
            var optionsContainer = document.createElement('div');
            optionsContainer.className = 'stage-options';
            optionsContainer.id = 'stageOptions';

            var shuffled = round.stages.slice().sort(function() { return Math.random() - 0.5; });
            shuffled.forEach(function(stage) {
                var option = document.createElement('div');
                option.className = 'stage-option';

                var emoji = document.createElement('span');
                emoji.className = 'opt-emoji';
                emoji.textContent = stage.emoji;
                option.appendChild(emoji);

                var label = document.createElement('span');
                label.className = 'opt-label';
                label.textContent = stage.label;
                option.appendChild(label);

                option.onclick = function() { selectLifecycleStage(stage, option); };
                optionsContainer.appendChild(option);
            });

            content.appendChild(optionsContainer);
        }

        function selectLifecycleStage(stage, element) {
            var round = lifecycleRoundsData[currentLifecycleRound];
            var expectedOrder = currentSlot + 1;

            if (stage.order === expectedOrder) {
                var slot = document.getElementById('slot-' + currentSlot);
                slot.classList.add('filled');
                clearChildren(slot);

                var emoji = document.createElement('span');
                emoji.className = 'stage-emoji';
                emoji.textContent = stage.emoji;
                slot.appendChild(emoji);

                var label = document.createElement('span');
                label.className = 'stage-label';
                label.textContent = stage.label;
                slot.appendChild(label);

                element.classList.add('used');
                currentSlot++;
                lifecycleCorrect++;
                totalScore++;
                playSound('correct');

                var positionWord = ['first', 'second', 'third', 'last'][expectedOrder - 1] || 'next';
                updateMascot('Correct! ' + stage.label + ' comes ' + positionWord + '!');
                updateProgress();

                if (currentSlot >= round.stages.length) {
                    currentLifecycleRound++;
                    setTimeout(showLifecycleRound, 1200);
                }
            } else {
                element.classList.add('wrong');
                playSound('wrong');

                var prevStage = currentSlot > 0 ? round.stages.find(function(s) { return s.order === currentSlot; }) : null;
                if (prevStage) {
                    updateMascot('Not quite! What comes after ' + prevStage.label + '?');
                } else {
                    updateMascot('What comes first in the life cycle?');
                }

                setTimeout(function() { element.classList.remove('wrong'); }, 500);
            }
        }

        // =====================
        // NEEDS TAB - Enhanced
        // =====================
        var needsRoundsData = [
            {
                type: 'select',
                question: 'Tap all the things plants NEED to grow!',
                items: [
                    { emoji: 'üíß', label: 'Water', isNeed: true },
                    { emoji: '‚òÄÔ∏è', label: 'Sunlight', isNeed: true },
                    { emoji: 'üåç', label: 'Soil', isNeed: true },
                    { emoji: 'üí®', label: 'Air', isNeed: true },
                    { emoji: 'üçï', label: 'Pizza', isNeed: false },
                    { emoji: 'üì±', label: 'Phone', isNeed: false }
                ],
                needCount: 4
            },
            {
                type: 'quiz',
                questions: [
                    { question: 'What do plants drink?', answer: 'Water', options: ['Water', 'Milk', 'Soda', 'Juice'], emoji: 'ü•§' },
                    { question: 'What gives plants energy to make food?', answer: 'Sunlight', options: ['Moonlight', 'Sunlight', 'Lamplight', 'Starlight'], emoji: 'üí°' },
                    { question: 'Where do plant roots grow?', answer: 'Soil', options: ['Air', 'Water', 'Soil', 'Sky'], emoji: 'üå±' },
                    { question: 'What invisible thing do plants breathe?', answer: 'Air', options: ['Water', 'Dirt', 'Air', 'Fire'], emoji: 'üå¨Ô∏è' }
                ]
            },
            {
                type: 'select',
                question: 'Which things help plants grow BIGGER?',
                items: [
                    { emoji: 'üåßÔ∏è', label: 'Rain', isNeed: true },
                    { emoji: 'üå§Ô∏è', label: 'Warm Sun', isNeed: true },
                    { emoji: 'ü™¥', label: 'Good Soil', isNeed: true },
                    { emoji: '‚ùÑÔ∏è', label: 'Snow', isNeed: false },
                    { emoji: 'üéÆ', label: 'Video Games', isNeed: false },
                    { emoji: 'üß∏', label: 'Toys', isNeed: false }
                ],
                needCount: 3
            }
        ];

        var currentNeedsRound = 0;
        var needsQuizIndex = 0;
        var foundNeedsInRound = 0;
        var needsCorrect = 0;

        function initNeedsTab() {
            createRoundDots('needsRounds', needsRoundsData.length, 0);
            showNeedsRound();
        }

        function showNeedsRound() {
            var content = document.getElementById('needsContent');
            clearChildren(content);
            foundNeedsInRound = 0;
            needsQuizIndex = 0;

            if (currentNeedsRound >= needsRoundsData.length) {
                markTabComplete('needs');
                totalScore += 4;
                updateProgress();
                updateMascot('Excellent! You know what plants need! Water, sunlight, soil, and air!');

                var msg = document.createElement('div');
                msg.className = 'fact-card';

                var h4 = document.createElement('h4');
                h4.textContent = 'üéâ Needs Complete!';
                msg.appendChild(h4);

                var p = document.createElement('p');
                p.textContent = 'Plants need water to drink, sunlight for energy, soil to grow in, and air to breathe!';
                msg.appendChild(p);

                content.appendChild(msg);
                return;
            }

            var round = needsRoundsData[currentNeedsRound];
            createRoundDots('needsRounds', needsRoundsData.length, currentNeedsRound);
            document.getElementById('needsCounter').textContent = 'Round ' + (currentNeedsRound + 1) + ' of ' + needsRoundsData.length;

            if (round.type === 'select') {
                showNeedsSelectRound(content, round);
            } else if (round.type === 'quiz') {
                showNeedsQuizRound(content, round);
            }
        }

        function showNeedsSelectRound(content, round) {
            var question = document.createElement('div');
            question.style.cssText = 'text-align: center; font-size: 1.1rem; font-weight: bold; color: #333; margin-bottom: 15px;';
            question.textContent = round.question;
            content.appendChild(question);

            var counter = document.createElement('div');
            counter.id = 'needsSelectCounter';
            counter.style.cssText = 'text-align: center; color: #666; margin-bottom: 15px;';
            counter.textContent = 'Found: 0 / ' + round.needCount;
            content.appendChild(counter);

            var grid = document.createElement('div');
            grid.className = 'needs-grid';

            var shuffled = round.items.slice().sort(function() { return Math.random() - 0.5; });
            shuffled.forEach(function(item) {
                var card = document.createElement('div');
                card.className = 'need-card';

                var emoji = document.createElement('div');
                emoji.className = 'need-emoji';
                emoji.textContent = item.emoji;
                card.appendChild(emoji);

                var label = document.createElement('div');
                label.className = 'need-label';
                label.textContent = item.label;
                card.appendChild(label);

                card.onclick = function() { checkNeedCard(item, card, round.needCount); };
                grid.appendChild(card);
            });

            content.appendChild(grid);
        }

        function checkNeedCard(item, card, needCount) {
            if (card.classList.contains('correct') || card.classList.contains('wrong')) return;

            if (item.isNeed) {
                card.classList.add('correct');
                foundNeedsInRound++;
                needsCorrect++;
                totalScore++;
                playSound('correct');
                updateMascot('Yes! Plants need ' + item.label.toLowerCase() + ' to grow!');

                var counter = document.getElementById('needsSelectCounter');
                if (counter) {
                    counter.textContent = 'Found: ' + foundNeedsInRound + ' / ' + needCount;
                }
                updateProgress();

                if (foundNeedsInRound >= needCount) {
                    currentNeedsRound++;
                    setTimeout(showNeedsRound, 1200);
                }
            } else {
                card.classList.add('wrong');
                playSound('wrong');
                updateMascot('Plants do not need ' + item.label.toLowerCase() + '! Try again!');
                setTimeout(function() { card.classList.remove('wrong'); }, 600);
            }
        }

        function showNeedsQuizRound(content, round) {
            showNeedsQuizQuestion(content, round, needsQuizIndex);
        }

        function showNeedsQuizQuestion(content, round, index) {
            clearChildren(content);

            if (index >= round.questions.length) {
                currentNeedsRound++;
                showNeedsRound();
                return;
            }

            var q = round.questions[index];

            var questionDiv = document.createElement('div');
            questionDiv.style.cssText = 'text-align: center; font-size: 1.2rem; font-weight: bold; color: #333; margin: 20px 0;';

            var emoji = document.createElement('div');
            emoji.style.fontSize = '3rem';
            emoji.textContent = q.emoji;
            questionDiv.appendChild(emoji);

            var text = document.createElement('div');
            text.textContent = q.question;
            questionDiv.appendChild(text);

            content.appendChild(questionDiv);

            var counter = document.createElement('div');
            counter.style.cssText = 'text-align: center; color: #666; margin-bottom: 15px;';
            counter.textContent = 'Question ' + (index + 1) + ' of ' + round.questions.length;
            content.appendChild(counter);

            var options = document.createElement('div');
            options.className = 'quiz-options';

            var shuffled = q.options.slice().sort(function() { return Math.random() - 0.5; });
            shuffled.forEach(function(opt) {
                var btn = document.createElement('button');
                btn.className = 'quiz-btn';
                btn.textContent = opt;
                btn.onclick = function() { checkNeedsQuiz(btn, opt, q.answer, options, content, round); };
                options.appendChild(btn);
            });

            content.appendChild(options);
        }

        function checkNeedsQuiz(btn, selected, correct, container, content, round) {
            var buttons = container.querySelectorAll('.quiz-btn');
            buttons.forEach(function(b) { b.style.pointerEvents = 'none'; });

            if (selected === correct) {
                btn.classList.add('correct');
                needsCorrect++;
                totalScore++;
                playSound('correct');
                updateMascot('Correct! ' + correct + ' helps plants grow!');
                updateProgress();
            } else {
                btn.classList.add('wrong');
                buttons.forEach(function(b) {
                    if (b.textContent === correct) b.classList.add('correct');
                });
                playSound('wrong');
                updateMascot('The answer is ' + correct + '!');
            }

            needsQuizIndex++;
            setTimeout(function() {
                showNeedsQuizQuestion(content, round, needsQuizIndex);
            }, 1500);
        }

        // Initialize all tabs
        initPartsTab();
        initTypesTab();
        initLifecycleTab();
        initNeedsTab();
    </script>
</body>
</html>
